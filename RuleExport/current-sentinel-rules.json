[
  {
    "AlertRuleTemplateName": "f71aba3d-28fb-450b-b192-4e76a83015c8",
    "Description": "Microsoft Sentinel uses Fusion, a correlation engine based on scalable machine learning algorithms, to automatically detect multistage attacks by identifying combinations of anomalous behaviors and suspicious activities that are observed at various stages of the kill chain. On the basis of these discoveries, Azure Sentinel generates incidents that would otherwise be very difficult to catch. By design, these incidents are low-volume, high-fidelity, and high-severity, which is why this detection is turned ON by default.\n\nSince Fusion correlates multiple signals from various products to detect advanced multistage attacks, successful Fusion detections are presented as Fusion incidents on the Microsoft Sentinel Incidents page. This rule covers the following detections:\n- Fusion for emerging threats\n- Fusion for ransomware\n- Scenario-based Fusion detections (122 scenarios)\n\nTo enable these detections, we recommend you configure the following data connectors for best results:\n- Out-of-the-box anomaly detections\n- Microsoft Entra ID Protection\n- Azure Defender\n- Azure Defender for IoT\n- Microsoft 365 Defender\n- Microsoft Cloud App Security    \n- Microsoft Defender for Endpoint\n- Microsoft Defender for Identity\n- Microsoft Defender for Office 365\n- Scheduled analytics rules, both built-in and those created by your security analysts. Analytics rules must contain kill-chain (tactics) and entity mapping information in order to be used by Fusion.\n\nFor the full description of each detection that is supported by Fusion, go to https://aka.ms/SentinelFusion.",
    "DisplayName": "Advanced Multistage Attack Detection",
    "Enabled": true,
    "Etag": "\"2b000b65-0000-0100-0000-62f1313d0000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/BuiltInFusion",
    "Kind": {},
    "LastModifiedUtc": "2022-08-08T15:52:29.4221499Z",
    "Name": "BuiltInFusion",
    "Severity": {},
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Collection",
      "CommandAndControl",
      "CredentialAccess",
      "DefenseEvasion",
      "Discovery",
      "Execution",
      "Exfiltration",
      "Impact",
      "InitialAccess",
      "LateralMovement",
      "Persistence",
      "PrivilegeEscalation"
    ],
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "0dd422ee-e6af-4204-b219-f59ac172e4c6",
    "Description": "This rule generates an alert when a Microsoft Threat Intelligence Indicator gets matched with your event logs. The alerts are very high fidelity.\n\nNote : It is advised to turn off any custom alert rules which match the threat intelligence indicators with the same event logs matched by this analytics to prevent duplicate alerts.",
    "DisplayName": "(Preview) Microsoft Threat Intelligence Analytics",
    "Enabled": true,
    "Etag": "\"2b00f1a3-0000-0100-0000-62f24b810000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/5f78d4ae-b5e5-4c2d-bf93-859fc1fe72d3",
    "Kind": {},
    "LastModifiedUtc": "2022-08-09T11:56:49.9050856Z",
    "Name": "5f78d4ae-b5e5-4c2d-bf93-859fc1fe72d3",
    "Severity": {},
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Persistence",
      "LateralMovement"
    ],
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": null,
    "Description": "Create incidents based on all alerts generated in Azure Active Directory Identity Protection",
    "DisplayName": "Create incidents based on Azure Active Directory Identity Protection alerts",
    "DisplayNamesExcludeFilter": null,
    "DisplayNamesFilter": null,
    "Enabled": false,
    "Etag": "\"5c009e07-0000-0100-0000-6543ff310000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/d9ad5ce9-7550-4b19-a775-84d64e6cb617",
    "Kind": {},
    "LastModifiedUtc": "2023-11-02T19:57:37.7323465Z",
    "Name": "d9ad5ce9-7550-4b19-a775-84d64e6cb617",
    "ProductFilter": {},
    "SeveritiesFilter": null,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "a6c435a2-b1a0-466d-b730-9f8af69262e8",
    "CustomDetail": {},
    "Description": "Identifies evidence of brute force activity against a user based on multiple authentication failures \nand at least one successful authentication within a given time window. Note that the query does not enforce any sequence,\nand does not require the successful authentication to occur last.\nThe default failure threshold is 10, success threshold is 1, and the default time window is 20 minutes.\nTo use this analytics rule, make sure you have deployed the [ASIM normalization parsers](https://aka.ms/ASimAuthentication)",
    "DisplayName": "Brute force attack against user credentials (Uses Authentication Normalization)",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0000204e-0000-0100-0000-62f3d2460000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/86ff7bcf-6111-4645-8c01-9c1c1c004438",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2022-08-10T15:44:05.7178398Z",
    "Name": "86ff7bcf-6111-4645-8c01-9c1c1c004438",
    "Query": "let failureCountThreshold = 5;\nlet successCountThreshold = 1;\n//let authenticationWindow = 20m; // Implicit in the analytic rule query period \nimAuthentication\n| summarize \n      StartTime = min(TimeGenerated), \n      EndTime = max(TimeGenerated), \n      IpAddresses = make_set (SrcDvcIpAddr, 100),\n      ReportedBy = make_set (strcat (EventVendor, \"/\", EventProduct), 100),\n      FailureCount = countif(EventResult=='Failure'),\n      SuccessCount = countif(EventResult=='Success')\n  by \n      TargetUserId, TargetUsername, TargetUserType \n| where FailureCount >= failureCountThreshold and SuccessCount >= successCountThreshold\n| extend\n      IpAddresses = strcat_array(IpAddresses, \", \"), \n      ReportedBy = strcat_array(ReportedBy, \", \")",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.2.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "80da0a8f-cfe1-4cd0-a895-8bc1771a720e",
    "CustomDetail": {},
    "Description": "Checks for event id 1102 which indicates the security event log was cleared. \nIt uses Event Source Name \"Microsoft-Windows-Eventlog\" to avoid generating false positives from other sources, like AD FS servers for instance.",
    "DisplayName": "Security Event log cleared",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"00001d4e-0000-0100-0000-62f3cbad0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": true,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/665f9380-8b5f-41aa-919d-cd5a377b47ca",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2022-08-10T15:15:57.1036072Z",
    "Name": "665f9380-8b5f-41aa-919d-cd5a377b47ca",
    "Query": "(union isfuzzy=true\n(\nSecurityEvent\n| where EventID == 1102 and EventSourceName == \"Microsoft-Windows-Eventlog\" \n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), EventCount = count() by Computer, Account, EventID, Activity\n| extend timestamp = StartTimeUtc, AccountCustomEntity = Account, HostCustomEntity = Computer\n),\n(\nWindowsEvent\n| where EventID == 1102 and Provider == \"Microsoft-Windows-Eventlog\"  \n| extend Account =  strcat(tostring(EventData.SubjectDomainName),\"\\\\\", tostring(EventData.SubjectUserName))\n| extend Activity= \"1102 - The audit log was cleared.\"\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), EventCount = count() by Computer, Account, EventID, Activity\n| extend timestamp = StartTimeUtc, AccountCustomEntity = Account, HostCustomEntity = Computer\n)\n)",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.1.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "'This will alert when an admin or app owner account adds a new credential to an Application or Service Principal where there was no previous verify KeyCredential associated.\n  If a threat actor obtains access to an account with sufficient privileges and adds the alternate authentication material triggering this event, the threat actor can now authenticate as the Application or Service Principal using this credential.\n  Additional information on OAuth Credential Grants can be found in RFC 6749 Section 4.4 or https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow\nFor further information on AuditLogs please see https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-audit-activities.'",
    "DisplayName": "First access credential added to Application or Service Principal where no credential was present(GH)",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"00001f4e-0000-0100-0000-62f3cdce0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/6f55a336-e01b-411b-906a-9779d29b4429",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2022-08-10T15:25:01.8627715Z",
    "Name": "6f55a336-e01b-411b-906a-9779d29b4429",
    "Query": "  AuditLogs\r\n  | where OperationName has_any (\"Add service principal\", \"Certificates and secrets management\") // captures \"Add service principal\", \"Add service principal credentials\", and \"Update application - Certificates and secrets management\" events\r\n  | where Result =~ \"success\"\r\n  | where tostring(InitiatedBy.user.userPrincipalName) has \"@\" or tostring(InitiatedBy.app.displayName) has \"@\"\r\n  | extend targetDisplayName = tostring(TargetResources[0].displayName)\r\n  | extend targetId = tostring(TargetResources[0].id)\r\n  | extend targetType = tostring(TargetResources[0].type)\r\n  | extend keyEvents = TargetResources[0].modifiedProperties\r\n  | mv-expand keyEvents\r\n  | where keyEvents.displayName =~ \"KeyDescription\"\r\n  | extend new_value_set = parse_json(tostring(keyEvents.newValue))\r\n  | extend old_value_set = parse_json(tostring(keyEvents.oldValue))\r\n  | where old_value_set == \"[]\"\r\n  | mv-expand new_value_set\r\n  | parse new_value_set with * \"KeyIdentifier=\" keyIdentifier:string \",KeyType=\" keyType:string \",KeyUsage=\" keyUsage:string \",DisplayName=\" keyDisplayName:string \"]\" *\r\n  | where keyUsage == \"Verify\"  or keyUsage == \"\"\r\n  | extend UserAgent = iff(AdditionalDetails[0].key == \"User-Agent\",tostring(AdditionalDetails[0].value),\"\")\r\n  | extend InitiatingUserOrApp = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\r\n  | extend InitiatingIpAddress = iff(isnotempty(InitiatedBy.user.ipAddress), tostring(InitiatedBy.user.ipAddress), tostring(InitiatedBy.app.ipAddress))\r\n  // The below line is currently commented out but Microsoft Sentinel users can modify this query to show only Application or only Service Principal events in their environment\r\n  //| where targetType =~ \"Application\" // or targetType =~ \"ServicePrincipal\"\r\n  | project-away new_value_set, old_value_set\r\n  | project-reorder TimeGenerated, OperationName, InitiatingUserOrApp, InitiatingIpAddress, UserAgent, targetDisplayName, targetId, targetType, keyDisplayName, keyType, keyUsage, keyIdentifier, CorrelationId, TenantId\r\n  | extend timestamp = TimeGenerated, AccountCustomEntity = InitiatingUserOrApp, IPCustomEntity = InitiatingIpAddress",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "",
    "DisplayName": "Longterm Leave Users SignIn Detected",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"00009f4f-0000-0100-0000-62f3f60b0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/49b5045b-9dc9-4ebe-80e9-090fbd2dd70f",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2022-08-10T18:16:42.1838336Z",
    "Name": "49b5045b-9dc9-4ebe-80e9-090fbd2dd70f",
    "Query": "SigninLogs\r\n| extend UserPrincipalName_ = tolower(UserPrincipalName) | join (_GetWatchlist('extendedLeaveA')\r\n| where leave == 1 \r\n| project UserNames = tolower(UserName)\r\n) on $left.UserPrincipalName_ ==  $right.UserNames",
    "QueryFrequency": {
      "Ticks": 9000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 15,
      "Seconds": 0,
      "TotalDays": 0.010416666666666666,
      "TotalHours": 0.25,
      "TotalMilliseconds": 900000.0,
      "TotalMinutes": 15.0,
      "TotalSeconds": 900.0
    },
    "QueryPeriod": {
      "Ticks": 9000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 15,
      "Seconds": 0,
      "TotalDays": 0.010416666666666666,
      "TotalHours": 0.25,
      "TotalMilliseconds": 900000.0,
      "TotalMinutes": 15.0,
      "TotalSeconds": 900.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "90586451-7ba8-4c1e-9904-7d1b7c3cc4d6",
    "Description": "Create incidents based on all alerts generated in Microsoft Defender for Cloud",
    "DisplayName": "Create incidents based on Microsoft Defender for Cloud",
    "DisplayNamesExcludeFilter": null,
    "DisplayNamesFilter": null,
    "Enabled": true,
    "Etag": "\"0c03ff7a-0000-0100-0000-6433ee650000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/921c877d-ee3b-43e6-9a37-48680ed50004",
    "Kind": {},
    "LastModifiedUtc": "2023-04-10T11:09:25.3014458Z",
    "Name": "921c877d-ee3b-43e6-9a37-48680ed50004",
    "ProductFilter": {},
    "SeveritiesFilter": [
      "Medium",
      "High"
    ],
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "223db5c1-1bf8-47d8-8806-bed401b356a4",
    "CustomDetail": {},
    "Description": "Identifies failed login attempts in the Azure Active Directory SigninLogs to the Azure Portal.  Many failed logon \nattempts or some failed logon attempts from multiple IPs could indicate a potential brute force attack.  \nThe following are excluded due to success and non-failure results:\nReferences: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes\n0 - successful logon\n50125 - Sign-in was interrupted due to a password reset or password registration entry.\n50140 - This error occurred due to 'Keep me signed in' interrupt when the user was signing-in.",
    "DisplayName": "Failed login attempts to Azure Portal-testing",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1100d2b7-0000-0100-0000-644038c50000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/ec11d6f8-b601-4d8d-84b5-996c0d47efbf",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-04-19T18:53:56.5001508Z",
    "Name": "ec11d6f8-b601-4d8d-84b5-996c0d47efbf",
    "Query": "\nlet timeRange = 1d;\nlet lookBack = 7d;\nlet threshold_Failed = 2;\nlet threshold_FailedwithSingleIP = 5;\nlet threshold_IPAddressCount = 1;\nlet isGUID = \"[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\";\nlet aadFunc = (tableName:string){\nlet azPortalSignins = materialize(table(tableName)\n| where TimeGenerated >= ago(lookBack)\n// Azure Portal only\n| where AppDisplayName =~ \"Azure Portal\")\n;\nlet successPortalSignins = azPortalSignins\n| where TimeGenerated >= ago(timeRange)\n// Azure Portal only and exclude non-failure Result Types\n| where ResultType in (\"0\", \"50125\", \"50140\")\n// Tagging identities not resolved to friendly names\n//| extend Unresolved = iff(Identity matches regex isGUID, true, false)\n| distinct TimeGenerated, UserPrincipalName\n;\nlet failPortalSignins = azPortalSignins\n| where TimeGenerated >= ago(timeRange)\n// Azure Portal only and exclude non-failure Result Types\n| where ResultType !in (\"0\", \"50125\", \"50140\", \"70044\", \"70043\")\n// Tagging identities not resolved to friendly names\n| extend Unresolved = iff(Identity matches regex isGUID, true, false)\n;\n// Verify there is no success for the same connection attempt after the fail\nlet failnoSuccess = failPortalSignins | join kind= leftouter (\n   successPortalSignins \n) on UserPrincipalName\n| where TimeGenerated > TimeGenerated1 or isempty(TimeGenerated1)\n| project-away TimeGenerated1, UserPrincipalName1\n;\n// Lookup up resolved identities from last 7 days\nlet identityLookup = azPortalSignins\n| where TimeGenerated >= ago(lookBack)\n| where not(Identity matches regex isGUID)\n| summarize by UserId, lu_UserDisplayName = UserDisplayName, lu_UserPrincipalName = UserPrincipalName;\n// Join resolved names to unresolved list from portal signins\nlet unresolvedNames = failnoSuccess | where Unresolved == true | join kind= inner (\n   identityLookup \n) on UserId\n| extend UserDisplayName = lu_UserDisplayName, UserPrincipalName = lu_UserPrincipalName\n| project-away lu_UserDisplayName, lu_UserPrincipalName;\n// Join Signins that had resolved names with list of unresolved that now have a resolved name\nlet u_azPortalSignins = failnoSuccess | where Unresolved == false | union unresolvedNames;\nu_azPortalSignins\n| extend DeviceDetail = todynamic(DeviceDetail), Status = todynamic(DeviceDetail), LocationDetails = todynamic(LocationDetails)\n| extend Status = strcat(ResultType, \": \", ResultDescription), OS = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\n| extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city), Region = tostring(LocationDetails.countryOrRegion)\n| extend FullLocation = strcat(Region,'|', State, '|', City)\n| summarize TimeGenerated = makelist(TimeGenerated), Status = makelist(Status), IPAddresses = makelist(IPAddress), IPAddressCount = dcount(IPAddress), FailedLogonCount = count()\nby UserPrincipalName, UserId, UserDisplayName, AppDisplayName, Browser, OS, FullLocation, Type\n| mvexpand TimeGenerated, IPAddresses, Status\n| extend TimeGenerated = todatetime(tostring(TimeGenerated)), IPAddress = tostring(IPAddresses), Status = tostring(Status)\n| project-away IPAddresses\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated) by UserPrincipalName, UserId, UserDisplayName, Status, FailedLogonCount, IPAddress, IPAddressCount, AppDisplayName, Browser, OS, FullLocation, Type\n| where (IPAddressCount >= threshold_IPAddressCount and FailedLogonCount >= threshold_Failed) or FailedLogonCount >= threshold_FailedwithSingleIP\n| extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress\n};\nlet aadSignin = aadFunc(\"SigninLogs\");\nlet aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\nunion isfuzzy=true aadSignin, aadNonInt\n",
    "QueryFrequency": {
      "Ticks": 1728000000000,
      "Days": 2,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 2.0,
      "TotalHours": 48.0,
      "TotalMilliseconds": 172800000.0,
      "TotalMinutes": 2880.0,
      "TotalSeconds": 172800.0
    },
    "QueryPeriod": {
      "Ticks": 6048000000000,
      "Days": 7,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 7.0,
      "TotalHours": 168.0,
      "TotalMilliseconds": 604800000.0,
      "TotalMinutes": 10080.0,
      "TotalSeconds": 604800.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.2",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "28b42356-45af-40a6-a0b4-a554cdfd5d8a",
    "CustomDetail": {},
    "Description": "Identifies evidence of brute force activity against Azure Portal by highlighting multiple authentication failures \nand by a successful authentication within a given time window. \nDefault Failure count is 5 and default Time Window is 20 minutes.\nReferences: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes.",
    "DisplayName": "Brute force attack against Azure Portal-testing",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1100c9b7-0000-0100-0000-644038c00000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/ccc40f64-d65b-4cbf-a1ea-fb5af3d506b0",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-04-19T18:53:51.3457226Z",
    "Name": "ccc40f64-d65b-4cbf-a1ea-fb5af3d506b0",
    "Query": "let timeRange = 24h;\nlet failureCountThreshold = 3;\nlet authenticationWindow = 10m;\nlet aadFunc = (tableName:string){\n table(tableName)\n| where AppDisplayName has \"Azure Portal\"\n| extend\n     DeviceDetail = todynamic(DeviceDetail),\n     //Status = todynamic(Status),\n     LocationDetails = todynamic(LocationDetails)\n| extend\n     OS = tostring(DeviceDetail.operatingSystem),\n     Browser = tostring(DeviceDetail.browser),\n     //StatusCode = tostring(Status.errorCode),\n     //StatusDetails = tostring(Status.additionalDetails),\n     State = tostring(LocationDetails.state),\n     City = tostring(LocationDetails.city),\n     Region = tostring(LocationDetails.countryOrRegion)\n// Split out failure versus non-failure types\n| extend FailureOrSuccess = iff(ResultType in (\"0\", \"50125\", \"50140\", \"70043\", \"70044\"), \"Success\", \"Failure\")  \n// bin outcomes based on authenticationWindow\n| summarize take_anyif(UserPrincipalName, not(UserPrincipalName matches regex @\"[a-f\\d]+\\-[a-f\\d]+\\-[a-f\\d]+\\-[a-f\\d]+\\-[a-f\\d]+\")),\n     take_anyif(UserDisplayName, isnotempty(UserDisplayName)),  FailureOrSuccessCount = count() by  FailureOrSuccess, UserId, UserDisplayName, AppDisplayName, IPAddress, Browser, OS, State, City, Region, Type, CorrelationId, bin(TimeGenerated, authenticationWindow), ResultType\n// sort for sessionizing - by UserPrincipalName and time of the authentication outcome\n| sort by UserPrincipalName asc, TimeGenerated asc\n| serialize \n// sessionize into failure groupings until either the account changes or there is a success\n| extend SessionStartedUtc = row_window_session(TimeGenerated, timeRange, authenticationWindow, UserPrincipalName != prev(UserPrincipalName) or prev(FailureOrSuccess) == \"Success\")\n// count the failures in each session\n| summarize FailureCountBeforeSuccess=sumif(FailureOrSuccessCount, FailureOrSuccess == \"Failure\"), StartTime=min(TimeGenerated), EndTime=max(TimeGenerated), makelist(FailureOrSuccess), IPAddress = make_set(IPAddress), make_set(Browser), make_set(City), make_set(State), make_set(Region), make_set(ResultType) by SessionStartedUtc, UserPrincipalName, CorrelationId, AppDisplayName, UserId, Type\n// the session must not start with a success, and must end with one\n| where array_index_of(list_FailureOrSuccess, \"Success\") != 0\n| where array_index_of(list_FailureOrSuccess, \"Success\") == array_length(list_FailureOrSuccess) - 1\n| project-away SessionStartedUtc, list_FailureOrSuccess\n// where the number of failures before the success is above the threshold \n| where FailureCountBeforeSuccess >= failureCountThreshold \n// expand out ip for entity assignment\n| mv-expand IPAddress\n| extend IPAddress = tostring(IPAddress)\n| extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress \n};\n let aadSignin = aadFunc(\"SigninLogs\");\n let aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\n union isfuzzy=true aadSignin, aadNonInt\n",
    "QueryFrequency": {
      "Ticks": 3000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 5,
      "Seconds": 0,
      "TotalDays": 0.003472222222222222,
      "TotalHours": 0.08333333333333333,
      "TotalMilliseconds": 300000.0,
      "TotalMinutes": 5.0,
      "TotalSeconds": 300.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "2.0.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "500c103a-0319-4d56-8e99-3cec8d860757",
    "CustomDetail": {},
    "Description": "Identifies IPs with failed attempts to sign in to one or more disabled accounts and where that same IP has had successful signins from other accounts.\nThis could indicate an attacker who obtained credentials for a list of accounts and is attempting to login with those accounts, some of which may have already been disabled.\nReferences: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes\n50057 - User account is disabled. The account has been disabled by an administrator.",
    "DisplayName": "Sign-ins from IPs that attempt sign-ins to disabled accounts-testing",
    "Enabled": false,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"110065b8-0000-0100-0000-6440390a0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/2e608441-b7d7-461a-9a6a-9b9e93cbe91a",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-04-19T18:55:06.372671Z",
    "Name": "2e608441-b7d7-461a-9a6a-9b9e93cbe91a",
    "Query": "\nlet aadFunc = (tableName:string){\ntable(tableName)\n| where ResultType == \"50057\" \n| where ResultDescription == \"User account is disabled. The account has been disabled by an administrator.\" \n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), disabledAccountLoginAttempts = count(), \ndisabledAccountsTargeted = dcount(UserPrincipalName), applicationsTargeted = dcount(AppDisplayName), disabledAccountSet = make_set(UserPrincipalName), \napplicationSet = make_set(AppDisplayName) by IPAddress, Type\n| order by disabledAccountLoginAttempts desc\n| join kind= leftouter (\n    // Consider these IPs suspicious - and alert any related  successful sign-ins\n    table(tableName)\n    | where ResultType == 0\n    | summarize successfulAccountSigninCount = dcount(UserPrincipalName), successfulAccountSigninSet = make_set(UserPrincipalName, 15) by IPAddress, Type\n    // Assume IPs associated with sign-ins from 100+ distinct user accounts are safe\n    | where successfulAccountSigninCount < 100\n) on IPAddress  \n// IPs from which attempts to authenticate as disabled user accounts originated, and had a non-zero success rate for some other account\n| where isnotempty(successfulAccountSigninCount)\n| project StartTime, EndTime, IPAddress, disabledAccountLoginAttempts, disabledAccountsTargeted, disabledAccountSet, applicationSet, \nsuccessfulAccountSigninCount, successfulAccountSigninSet, Type\n| order by disabledAccountLoginAttempts\n| extend timestamp = StartTime, IPCustomEntity = IPAddress\n};\nlet aadSignin = aadFunc(\"SigninLogs\");\nlet aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\nunion isfuzzy=true aadSignin, aadNonInt\n",
    "QueryFrequency": {
      "Ticks": 6000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 10,
      "Seconds": 0,
      "TotalDays": 0.006944444444444444,
      "TotalHours": 0.16666666666666666,
      "TotalMilliseconds": 600000.0,
      "TotalMinutes": 10.0,
      "TotalSeconds": 600.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess",
      "Persistence"
    ],
    "TemplateVersion": "1.1.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": "Deny count alert from {{SourceIP}} to {{DestinationIP}} \n",
    "AlertDetailOverrideAlertDisplayNameFormat": "High number of denies alert from {{SourceIP}}",
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "Look for new Cisco events",
    "DisplayName": "Cisco Test",
    "Enabled": false,
    "EntityMapping": null,
    "Etag": "\"0101abe1-0000-0100-0000-64b6b7ec0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/b780d202-dd5a-4190-86bc-0c0632a8ce16",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-07-18T16:03:56.3728587Z",
    "Name": "b780d202-dd5a-4190-86bc-0c0632a8ce16",
    "Query": "CommonSecurityLog\n| where DeviceVendor == \"Cisco\"\n| where DeviceAction == \"Deny\"\n| summarize DenyCount = count() by SourceIP, DestinationIP\n| where DenyCount > 5\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": true,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "LateralMovement"
    ],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "fa118b98-de46-4e94-87f9-8e6d5060b60b",
    "Description": "This detection uses machine learning (ML) to identify anomalous Secure Shell (SSH) login activity, based on syslog data. Scenarios include:\n\n*\tUnusual IP - This IP address has not or has rarely been seen in last 30 days.\n*\tUnusual Geo - The IP address, city, country and ASN have not (or rarely) been seen in last 30 days.\n*\tNew user - A new user logs in from an IP address and geo location, both or either of which are not expected to be seen in the last 30 days.\n\nAllow 7 days after this alert is enabled for Microsoft Sentinel to build a profile of normal activity for your environment.\n\nThis detection requires a specific configuration of the data source. [Learn more](https://docs.microsoft.com/en-us/azure/sentinel/connect-syslog#configure-the-syslog-connector-for-anomalous-ssh-login-detection)\n\nBy enabling this rule, you give Microsoft permission to copy ingested data outside of your Microsoft Sentinel workspace's geography as necessary for processing by the machine learning engine.",
    "DisplayName": "(Preview) Anomalous SSH Login Detection",
    "Enabled": true,
    "Etag": "\"4b00ad79-0000-0100-0000-64c012ad0000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/8249e02a-01c5-4930-8a4e-fec7c2850d2f",
    "Kind": {},
    "LastModifiedUtc": "2023-07-25T18:21:33.8720608Z",
    "Name": "8249e02a-01c5-4930-8a4e-fec7c2850d2f",
    "Severity": {},
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "b9d2eebc-5dcb-4888-8165-900db44443ab",
    "CustomDetail": {},
    "Description": "This query detects potential attempts by non-computer accounts (non domain controllers) to retrieve/synchronize an active directory object leveraging directory replication services (DRS).\nA Domain Controller (computer account) would usually be performing these actions in a domain environment. Another detection rule can be created to cover domain controllers accounts doing at rare times.\nA domain user with privileged permissions to use directory replication services is rare. Ref: https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html",
    "DisplayName": "Non Domain Controller Active Directory Replication",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"28003499-0000-0100-0000-64c9710f0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/e11e3aeb-21f7-460b-929a-ba54479aab9d",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T20:54:38.6324739Z",
    "Name": "e11e3aeb-21f7-460b-929a-ba54479aab9d",
    "Query": "// Enter a reference list of hostnames for your DC servers\n//let DCServersList = dynamic ([\"DC01.simulandlabs.com\",\"DC02.simulandlabs.com\"]);\nSecurityEvent\n//| where Computer in (DCServersList)\n| where EventID == 4662 and ObjectServer == 'DS'\n| where AccountType != 'Machine'\n| where Properties has '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes\n    or Properties has '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes-All\n    or Properties has '89e95b76-444d-4c62-991a-0facbeda640c' //DS-Replication-Get-Changes-In-Filtered-Set\n| project TimeGenerated, Account, Activity, Properties, SubjectLogonId, Computer\n| join kind=leftouter\n    (\n    SecurityEvent\n    //| where Computer in (DCServersList)\n    | where EventID == 4624 and LogonType == 3\n    | where AccountType != 'Machine'\n    | project TargetLogonId, IpAddress\n    )\n    on $left.SubjectLogonId == $right.TargetLogonId\n| project-reorder TimeGenerated, Computer, Account, IpAddress\n| extend\n    timestamp = TimeGenerated,\n    AccountCustomEntity = Account,\n    HostCustomEntity = Computer,\n    SourceAddress = IpAddress \n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 6048000000000,
      "Days": 7,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 7.0,
      "TotalHours": 168.0,
      "TotalMilliseconds": 604800000.0,
      "TotalMinutes": 10080.0,
      "TotalSeconds": 604800.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "2f4165a6-c4fb-4e94-861e-37f1b4d6c0e6",
    "CustomDetail": {},
    "Description": "This detection uses Security events from the \"AD FS Auditing\" provider to detect suspicious authentication events on an AD FS server. The results then get\ncorrelated with events from the Windows Filtering Platform (WFP) to detect suspicious incoming network traffic on port 80 on the AD FS server.\nThis could be a sign of a threat actor trying to use replication services on the AD FS server to get its configuration settings and extract\nsensitive information such as AD FS certificates.\nIn order to use this query you need to enable AD FS auditing on the AD FS Server.\nReferences: \nhttps://docs.microsoft.com/windows-server/identity/ad-fs/troubleshooting/ad-fs-tshoot-logging\nhttps://twitter.com/OTR_Community/status/1387038995016732672",
    "DisplayName": "AD FS Remote Auth Sync Connection",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2800769a-0000-0100-0000-64c9728a0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/24cab23d-c244-4cdf-9978-d33a71bd06a9",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T21:00:58.1391766Z",
    "Name": "24cab23d-c244-4cdf-9978-d33a71bd06a9",
    "Query": "// Adjust this to use a longer timeframe to identify ADFS servers\n//let lookback = 0d;\n// Adjust this to adjust detection timeframe\n//let timeframe = 1d;\n// SamAccountName of AD FS Service Account. Filter on the use of a specific AD FS user account\n//let adfsuser = 'adfsadmin';\n// Identify ADFS Servers\nlet ADFS_Servers = (\n    SecurityEvent\n    //| where TimeGenerated > ago(timeframe+lookback)\n    | where EventSourceName == 'AD FS Auditing'\n    | distinct Computer\n    );\nSecurityEvent\n//| where TimeGenerated > ago(timeframe)\n| where Computer in~ (ADFS_Servers)\n// A token of type 'http://schemas.microsoft.com/ws/2006/05/servicemodel/tokens/SecureConversation'\n// for relying party '-' was successfully authenticated.\n| where EventID == 412\n| extend EventData = parse_xml(EventData).EventData.Data\n| extend InstanceId = tostring(EventData[0])\n| join kind=inner\n    (\n    SecurityEvent\n    //| where TimeGenerated > ago(timeframe)\n    | where Computer in~ (ADFS_Servers)\n    // Events to identify caller identity from event 412\n    | where EventID == 501\n    | extend EventData = parse_xml(EventData).EventData.Data\n    | where tostring(EventData[1]) contains 'identity/claims/name'\n    | extend InstanceId = tostring(EventData[0])\n    | extend ClaimsName = tostring(EventData[2])\n    // Filter on the use of a specific AD FS user account\n    //| where ClaimsName contains adfsuser\n    )\n    on $left.InstanceId == $right.InstanceId\n| join kind=inner\n    (\n    SecurityEvent\n    | where EventID == 5156\n    | where Computer in~ (ADFS_Servers)\n    | extend EventData = parse_xml(EventData).EventData.Data\n    | mv-expand bagexpansion=array EventData\n    | evaluate bag_unpack(EventData)\n    | extend\n        Key = tostring(column_ifexists('@Name', \"\")),\n        Value = column_ifexists('#text', \"\")\n    | evaluate pivot(Key, any(Value), TimeGenerated, Computer, EventID)\n    | extend\n        DestPort = column_ifexists(\"DestPort\", \"\"),\n        Direction = column_ifexists(\"Direction\", \"\"),\n        Application = column_ifexists(\"Application\", \"\"),\n        DestAddress = column_ifexists(\"DestAddress\", \"\"),\n        SourceAddress = column_ifexists(\"SourceAddress\", \"\"),\n        SourcePort = column_ifexists(\"SourcePort\", \"\")\n    // Look for inbound connections from endpoints on port 80\n    | where DestPort == 80 and Direction == '%%14592' and Application == 'System'\n    | where DestAddress !in ('::1', '0:0:0:0:0:0:0:1') \n    )\n    on $left.Computer == $right.Computer\n| project TimeGenerated, Computer, ClaimsName, SourceAddress, SourcePort\n| extend\n    HostCustomEntity = Computer,\n    AccountCustomEntity = ClaimsName,\n    IPCustomEntity = SourceAddress\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Collection"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "a356c8bd-c81d-428b-aa36-83be706be034",
    "CustomDetail": {},
    "Description": "This detection uses Windows security events to detect suspicious access attempts by the same process\n to registry keys that provide information about an AAD joined or registered devices and Transport keys (tkpub / tkpriv).\n This information can be used to export the Device Certificate (dkpub / dkpriv) and Transport key (tkpub/tkpriv).\n These set of keys can be used to impersonate existing Azure AD joined devices.\n This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable objects:\n HKLM:\\SYSTEM\\CurrentControlSet\\Control\\CloudDomainJoin (AAD joined devices)\n HKCU:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\WorkplaceJoin (AAD registered devices)\n HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Cryptography\\Ngc\\KeyTransportKey (Transport Key)\n Make sure you set the SACL to propagate to its sub-keys. You can find more information in here https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml\n Reference: https://o365blog.com/post/deviceidentity/",
    "DisplayName": "AAD Local Device Join Information and Transport Key Registry Keys Access",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2800f69a-0000-0100-0000-64c973e70000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/44674e46-e92f-4b5e-a592-228cc7379a2d",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T21:06:46.5973754Z",
    "Name": "44674e46-e92f-4b5e-a592-228cc7379a2d",
    "Query": "// AADJoined or Register Device Registry Keys\nlet aadJoinRoot = \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\ControlSet001\\\\Control\\\\CloudDomainJoin\\\\JoinInfo\\\\\";\nlet aadRegisteredRoot = \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\WorkplaceJoin\";\n// Transport Key Registry Key\nlet keyTransportKey = \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\ControlSet001\\\\Control\\\\Cryptography\\\\Ngc\\\\KeyTransportKey\\\\\";\n(union isfuzzy=true\n    (\n    // Access to Object Requested\n    SecurityEvent\n    | where EventID == '4656'\n    | where EventData has aadJoinRoot or EventData has aadRegisteredRoot\n    | extend EventData = parse_xml(EventData).EventData.Data\n    | mv-expand bagexpansion=array EventData\n    | evaluate bag_unpack(EventData)\n    | extend\n        Key = tostring(column_ifexists('@Name', \"\")),\n        Value = column_ifexists('#text', \"\")\n    | evaluate pivot(Key, any(Value), TimeGenerated, Computer, EventID)\n    | where ObjectType == 'Key'\n    | where ObjectName startswith aadJoinRoot and SubjectLogonId != '0x3e7' //Local System\n    | extend\n        ProcessId = column_ifexists(\"ProcessId\", \"\"),\n        Process = split(ProcessName, '\\\\', -1)[-1],\n        Account = strcat(SubjectDomainName, \"\\\\\", SubjectUserName)\n    | join kind=innerunique (\n        SecurityEvent\n        | where EventID == '4656'\n        | where EventData has keyTransportKey\n        | extend EventData = parse_xml(EventData).EventData.Data\n        | mv-expand bagexpansion=array EventData\n        | evaluate bag_unpack(EventData)\n        | extend\n            Key = tostring(column_ifexists('@Name', \"\")),\n            Value = column_ifexists('#text', \"\")\n        | evaluate pivot(Key, any(Value), TimeGenerated, Computer, EventID)\n        | extend\n            ObjectName = column_ifexists(\"ObjectName\", \"\"),\n            ObjectType = column_ifexists(\"ObjectType\", \"\")\n        | where ObjectType == 'Key'\n        | where ObjectName startswith keyTransportKey and SubjectLogonId != '0x3e7' //Local System\n        | extend\n            ProcessId = column_ifexists(\"ProcessId\", \"\"),\n            Process = split(ProcessName, '\\\\', -1)[-1],\n            Account = strcat(SubjectDomainName, \"\\\\\", SubjectUserName)\n        )\n        on $left.Computer == $right.Computer and $left.SubjectLogonId == $right.SubjectLogonId and $left.ProcessId == $right.ProcessId\n    | project\n        TimeGenerated,\n        Computer,\n        Account,\n        SubjectDomainName,\n        SubjectUserName,\n        SubjectLogonId,\n        ObjectName,\n        tostring(Process),\n        ProcessName,\n        ProcessId,\n        EventID\n    ),\n    // Accessing Object\n    (\n    SecurityEvent\n    | where EventID == '4663'\n    | where ObjectType == 'Key'\n    | where (ObjectName startswith aadJoinRoot or ObjectName contains aadRegisteredRoot) and SubjectLogonId != '0x3e7' //Local System\n    | extend Account = SubjectAccount\n    | join kind=innerunique (\n        SecurityEvent\n        | where EventID == '4663'\n        | where ObjectType == 'Key'\n        | where ObjectName has keyTransportKey and SubjectLogonId != '0x3e7' //Local System\n        | extend Account = SubjectAccount\n        )\n        on $left.Computer == $right.Computer and $left.SubjectLogonId == $right.SubjectLogonId and $left.ProcessId == $right.ProcessId\n    | project\n        TimeGenerated,\n        Computer,\n        Account,\n        SubjectDomainName,\n        SubjectUserName,\n        SubjectLogonId,\n        ObjectName,\n        Process,\n        ProcessName,\n        ProcessId,\n        EventID\n    | extend\n        HostName = tostring(split(Computer, '.', 0)[0]),\n        DnsDomain = tostring(strcat_array(array_slice(split(Computer, '.'), 1, -1), '.'))\n    )\n)\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Discovery"
    ],
    "TemplateVersion": "1.0.2",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "56f3f35c-3aca-4437-a1fb-b7a84dc4af00",
    "CustomDetail": {},
    "Description": "This detection looks for the steps required to conduct a UAC bypass using Fodhelper.exe. By default this detection looks for the setting of the required registry keys and the invoking of the process within 1 hour - this can be tweaked as required.",
    "DisplayName": "Potential Fodhelper UAC Bypass",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"28001aa0-0000-0100-0000-64c978070000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/4945f067-ed4c-46e4-bac6-3d976b2827d5",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T21:24:21.5626232Z",
    "Name": "4945f067-ed4c-46e4-bac6-3d976b2827d5",
    "Query": "SecurityEvent\n  | where EventID == 4657\n  | parse ObjectName with \"\\\\REGISTRY\\\\\" KeyPrefix \"\\\\\" RegistryKey\n  | project-reorder RegistryKey\n  | where RegistryKey has \"Software\\\\Classes\\\\ms-settings\\\\shell\\\\open\\\\command\"\n  | extend TimeKey = bin(TimeGenerated, 1h)\n  | join (\n  SecurityEvent\n  | where EventID == 4688\n  | where Process =~ \"fodhelper.exe\"\n  | where ParentProcessName endswith \"cmd.exe\" or ParentProcessName endswith \"powershell.exe\" or ParentProcessName endswith \"powershell_ise.exe\"\n  | extend TimeKey = bin(TimeGenerated, 1h)) on TimeKey, Computer\n",
    "QueryFrequency": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "QueryPeriod": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "PrivilegeEscalation"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "12dcea64-bec2-41c9-9df2-9f28461b1295",
    "CustomDetail": {},
    "Description": "This query detects instances where an attacker has gained the ability to execute code on an ADFS Server through SMB and Remote Service or Scheduled Task.",
    "DisplayName": "Gain Code Execution on ADFS Server via SMB + Remote Service or Scheduled Task",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"280076a0-0000-0100-0000-64c978940000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/b728beb9-cf5e-4a11-b50e-b727eb3f413c",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T21:26:43.3058623Z",
    "Name": "b728beb9-cf5e-4a11-b50e-b727eb3f413c",
    "Query": "let timeframe = 1d;\n// Adjust for a longer timeframe for identifying ADFS Servers\nlet lookback = 6d;\n// Identify ADFS Servers\nlet ADFS_Servers = (\n    SecurityEvent\n    | where TimeGenerated > ago(timeframe + lookback)\n    | where EventID == 4688 and SubjectLogonId != \"0x3e4\"\n    | where NewProcessName has \"Microsoft.IdentityServer.ServiceHost.exe\"\n    | distinct Computer\n    );\nSecurityEvent\n| where TimeGenerated > ago(timeframe)\n| where Computer in~ (ADFS_Servers)\n| where Account !endswith \"$\"\n// Check for scheduled task events\n| where EventID in (4697, 4698, 4699, 4700, 4701, 4702)\n| extend EventDataParsed = parse_xml(EventData)\n| extend SubjectLogonId = tostring(EventDataParsed.EventData.Data[3][\"#text\"])\n// Check specifically for access to IPC$ share and PIPE\\svcctl and PIPE\\atsvc for Service Control Services and Schedule Control Services\n| union (\n    SecurityEvent\n    | where TimeGenerated > ago(timeframe)\n    | where Computer in~ (ADFS_Servers)\n    | where Account !endswith \"$\"\n    | where EventID == 5145\n    | where RelativeTargetName =~ \"svcctl\" or RelativeTargetName =~ \"atsvc\"\n    )\n// Check for lateral movement\n| join kind=inner\n    (SecurityEvent\n    | where TimeGenerated > ago(timeframe)\n    | where Account !endswith \"$\"\n    | where EventID == 4624 and LogonType == 3\n    )\n    on $left.SubjectLogonId == $right.TargetLogonId\n| project TimeGenerated, Account, Computer, EventID, RelativeTargetName\n| extend\n    timestamp = TimeGenerated,\n    HostCustomEntity = Computer,\n    AccountCustomEntity = Account\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 6048000000000,
      "Days": 7,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 7.0,
      "TotalHours": 168.0,
      "TotalMilliseconds": 604800000.0,
      "TotalMinutes": 10080.0,
      "TotalSeconds": 604800.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "LateralMovement"
    ],
    "TemplateVersion": "1.2.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "2bc7b4ae-eeaa-4538-ba15-ef298ec1ffae",
    "CustomDetail": {},
    "Description": "This query detects events where an actor is stopping or starting HealthService to disable telemetry collection/detection from the agent.\n The query requires a SACL to audit for access request to the service.",
    "DisplayName": "Starting or Stopping HealthService to Avoid Detection",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"280076a4-0000-0100-0000-64c97d020000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/76311295-8730-4652-ba46-6e4525d7ec58",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-01T21:45:37.6258361Z",
    "Name": "76311295-8730-4652-ba46-6e4525d7ec58",
    "Query": "SecurityEvent\n| where EventID == 4656\n| extend EventData = parse_xml(EventData).EventData.Data\n| mv-expand bagexpansion=array EventData\n| evaluate bag_unpack(EventData)\n| extend Key = tostring(column_ifexists('@Name', \"\")), Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, TargetAccount, Computer, EventSourceName, Channel, Task, Level, EventID, Activity, TargetLogonId, SourceComputerId, EventOriginId, Type, _ResourceId, TenantId, SourceSystem, ManagementGroupName, IpAddress, Account)\n| extend ObjectServer = column_ifexists('ObjectServer', \"\"), ObjectType = column_ifexists('ObjectType', \"\"), ObjectName = column_ifexists('ObjectName', \"\")\n| where isnotempty(ObjectServer) and isnotempty(ObjectType) and isnotempty(ObjectName)\n| where ObjectServer =~ \"SC Manager\" and ObjectType =~ \"SERVICE OBJECT\" and ObjectName =~ \"HealthService\"\n// Comment out the join below if the SACL only audits users that are part of the Network logon users, i.e. with user/group target pointing to \"NU.\"\n| join kind=leftouter (\n  SecurityEvent\n  | where EventID == 4624\n) on TargetLogonId\n| project TimeGenerated, Computer, Account, TargetAccount, IpAddress,TargetLogonId, ObjectServer, ObjectType, ObjectName\n| extend timestamp = TimeGenerated, HostCustomEntity = Computer, AccountCustomEntity = Account, IPCustomEntity = IpAddress\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "dcdf9bfc-c239-4764-a9f9-3612e6dff49c",
    "CustomDetail": {},
    "Description": "This detection uses Sysmon telemetry to detect suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database).\nIn order to use this query you need to be collecting Sysmon EventIdD 18 (Pipe Connected).\nIf you do not have Sysmon data in your workspace this query will raise an error stating:\nFailed to resolve scalar expression named \"[@Name]\"",
    "DisplayName": "ADFS Database Named Pipe Connection",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"29001c35-0000-0100-0000-64cab8220000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/843a2dbe-6a17-4660-82a8-0e258965953b",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:10:07.5237445Z",
    "Name": "843a2dbe-6a17-4660-82a8-0e258965953b",
    "Query": "// Adjust this to use a longer timeframe to identify ADFS servers\n//let lookback = 6d;\n// Adjust this to adjust the key export detection  timeframe\n//let timeframe = 1d;\n// Start be identifying ADFS servers to reduce FP chance\nlet ADFS_Servers = (\n    Event\n    //| where TimeGenerated > ago(timeframe+lookback)\n    | where Source == \"Microsoft-Windows-Sysmon\"\n    | where EventID == 18\n    | extend EventData = parse_xml(EventData).DataItem.EventData.Data\n    | mv-expand bagexpansion=array EventData\n    | evaluate bag_unpack(EventData)\n    | extend\n        Key = tostring(column_ifexists('@Name', \"\")),\n        Value = column_ifexists('#text', \"\")\n    | evaluate pivot(Key, any(Value), TimeGenerated, Source, EventLog, Computer, EventLevel, EventLevelName, EventID, UserName, MG, ManagementGroupName, _ResourceId)\n    | extend Image = column_ifexists(\"Image\", \"\")\n    | extend process = split(Image, '\\\\', -1)[-1]\n    | where process =~ \"Microsoft.IdentityServer.ServiceHost.exe\"\n    | summarize by Computer);\n// Look for ADFS servers where Named Pipes event are present\nEvent\n//| where TimeGenerated > ago(timeframe)\n| where Source == \"Microsoft-Windows-Sysmon\"\n| where EventID == 18\n| where Computer in~ (ADFS_Servers)\n| extend RenderedDescription = tostring(split(RenderedDescription, \":\")[0])\n| extend EventData = parse_xml(EventData).DataItem.EventData.Data\n| mv-expand bagexpansion=array EventData\n| evaluate bag_unpack(EventData)\n| extend\n    Key = tostring(column_ifexists('@Name', \"\")),\n    Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, Source, EventLog, Computer, EventLevel, EventLevelName, EventID, UserName, RenderedDescription, MG, ManagementGroupName, Type, _ResourceId)\n| extend\n    RuleName = column_ifexists(\"RuleName\", \"\"),\n    TechniqueId = column_ifexists(\"TechniqueId\", \"\"),\n    TechniqueName = column_ifexists(\"TechniqueName\", \"\"),\n    Image = column_ifexists(\"Image\", \"\"),\n    PipeName = column_ifexists(\"PipeName\", \"\"),\n    EventType = column_ifexists(\"EventType\", \"\")\n| parse RuleName with * 'technique_id=' TechniqueId ',' * 'technique_name=' TechniqueName\n// Look for Pipe related to querying the WID\n| where PipeName == \"\\\\MICROSOFT##WID\\\\tsql\\\\query\"\n| extend process = split(Image, '\\\\', -1)[-1]\n// Exclude expected processes\n| where process !in (\"Microsoft.IdentityServer.ServiceHost.exe\", \"Microsoft.Identity.Health.Adfs.PshSurrogate.exe\", \"AzureADConnect.exe\", \"Microsoft.Tri.Sensor.exe\", \"wsmprovhost.exe\", \"mmc.exe\", \"sqlservr.exe\")\n| extend Operation = RenderedDescription\n| project-reorder TimeGenerated, EventType, Operation, process, Image, Computer, UserName\n| extend HostCustomEntity = Computer, AccountCustomEntity = UserName\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Collection"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "62085097-d113-459f-9ea7-30216f2ee6af",
    "CustomDetail": {},
    "Description": "Identifies when an account is enabled with a default password and the password is not set by the user within 48 hours.\nEffectively, there is an event 4722 indicating an account was enabled and within 48 hours, no event 4723 occurs which\nindicates there was no attempt by the user to set the password. This will show any attempts (success or fail) that occur\nafter 48 hours, which can indicate too long of a time period in setting the password to something that only the user knows.\nIt is recommended that this time period is adjusted per your internal company policy.",
    "DisplayName": "AD user enabled and password not set within 48 hours",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"29003d36-0000-0100-0000-64cab96a0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/91b47676-7dda-4283-a7bf-ad73aa6f9cba",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:15:37.5996977Z",
    "Name": "91b47676-7dda-4283-a7bf-ad73aa6f9cba",
    "Query": "let starttime = 3d;\nlet SecEvents = materialize (SecurityEvent\n    | where TimeGenerated >= ago(starttime)\n    | where EventID in (4722, 4723)\n    | where TargetUserName !endswith \"$\"\n    | project\n        TimeGenerated,\n        EventID,\n        Activity,\n        Computer,\n        TargetAccount,\n        TargetSid,\n        SubjectAccount,\n        SubjectUserSid);\nlet userEnable = SecEvents\n    | extend EventID4722Time = TimeGenerated\n    // 4722: User Account Enabled\n    | where EventID == 4722\n    | project\n        Time_Event4722 = TimeGenerated,\n        TargetAccount,\n        TargetSid,\n        SubjectAccount_Event4722 = SubjectAccount,\n        SubjectUserSid_Event4722 = SubjectUserSid,\n        Activity_4722 = Activity,\n        Computer_4722 = Computer;\nlet userPwdSet = SecEvents\n    // 4723: Attempt made by user to set password\n    | where EventID == 4723\n    | project\n        Time_Event4723 = TimeGenerated,\n        TargetAccount,\n        TargetSid,\n        SubjectAccount_Event4723 = SubjectAccount,\n        SubjectUserSid_Event4723 = SubjectUserSid,\n        Activity_4723 = Activity,\n        Computer_4723 = Computer;\nuserEnable\n| join kind=leftouter userPwdSet on TargetAccount, TargetSid\n| extend PasswordSetAttemptDelta_Min = datetime_diff('minute', Time_Event4723, Time_Event4722)\n| where PasswordSetAttemptDelta_Min > 2880 or isempty(PasswordSetAttemptDelta_Min)\n| project-away TargetAccount1, TargetSid1\n| extend Reason = @\"User either has not yet attempted to set the initial password after account was enabled or it occurred after 48 hours\"\n| order by Time_Event4722 asc\n| extend\n    timestamp = Time_Event4722,\n    AccountCustomEntity = TargetAccount,\n    HostCustomEntity = Computer_4722\n| project-reorder\n    Time_Event4722,\n    Time_Event4723,\n    PasswordSetAttemptDelta_Min,\n    TargetAccount,\n    TargetSid\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 2592000000000,
      "Days": 3,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 3.0,
      "TotalHours": 72.0,
      "TotalMilliseconds": 259200000.0,
      "TotalMinutes": 4320.0,
      "TotalSeconds": 259200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Persistence"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "2c55fe7a-b06f-4029-a5b9-c54a2320d7b8",
    "CustomDetail": {},
    "Description": "This detection identifies anomalous spike in frequency of executions of sensitive processes which are often leveraged as attack vectors.\nThe query leverages KQL's built-in anomaly detection algorithms to find large deviations from baseline patterns.\nSudden increases in execution frequency of sensitive processes should be further investigated for malicious activity.\nTune the values from 1.5 to 3 in series_decompose_anomalies for further outliers or based on custom threshold values for score.",
    "DisplayName": "Process Execution Frequency Anomaly",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"29005e36-0000-0100-0000-64caba550000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/ab5d272c-99b6-4b23-bc35-725b5ac89d75",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:19:32.9737712Z",
    "Name": "ab5d272c-99b6-4b23-bc35-725b5ac89d75",
    "Query": "let starttime = 14d;\nlet endtime = 1d;\nlet timeframe = 1h;\nlet TotalEventsThreshold = 5;\n// Configure the list with sensitive process names \nlet ExeList = dynamic([\"powershell.exe\", \"cmd.exe\", \"wmic.exe\", \"psexec.exe\", \"cacls.exe\", \"rundll32.exe\"]);\nlet TimeSeriesData =\n    SecurityEvent\n    | where EventID == 4688\n    | extend Process = tolower(Process)\n    | where TimeGenerated between (startofday(ago(starttime)) .. startofday(ago(endtime)))\n    | where Process in~ (ExeList)\n    | project TimeGenerated, Computer, AccountType, Account, Process\n    | make-series Total=count() on TimeGenerated from startofday(ago(starttime)) to startofday(ago(endtime)) step timeframe by Process;\nlet TimeSeriesAlerts = materialize(TimeSeriesData\n    | extend (anomalies, score, baseline) = series_decompose_anomalies(Total, 1.5, -1, 'linefit')\n    | mv-expand\n        Total to typeof(double),\n        TimeGenerated to typeof(datetime),\n        anomalies to typeof(double),\n        score to typeof(double),\n        baseline to typeof(long)\n    | where anomalies > 0\n    | project Process, TimeGenerated, Total, baseline, anomalies, score\n    | where Total > TotalEventsThreshold);\nlet AnomalyHours = materialize(TimeSeriesAlerts\n    | where TimeGenerated > ago(2d)\n    | project TimeGenerated);\nTimeSeriesAlerts\n| where TimeGenerated > ago(2d)\n| join (\n    SecurityEvent\n    | where TimeGenerated between (startofday(ago(starttime)) .. startofday(ago(endtime)))\n    | extend DateHour = bin(TimeGenerated, 1h) // create a new column and round to hour\n    | where DateHour in ((AnomalyHours)) //filter the dataset to only selected anomaly hours\n    | where EventID == 4688\n    | extend Process = tolower(Process)\n    | summarize CommandlineCount = count() by bin(TimeGenerated, 1h), Process, CommandLine, Computer, Account\n    )\n    on Process, TimeGenerated\n| project\n    AnomalyHour = TimeGenerated,\n    Computer,\n    Account,\n    Process,\n    CommandLine,\n    CommandlineCount,\n    Total,\n    baseline,\n    anomalies,\n    score\n| extend\n    timestamp = AnomalyHour,\n    NTDomain = split(Account, '\\\\', 0)[0],\n    Name = split(Account, '\\\\', 1)[0],\n    HostName = tostring(split(Computer, '.', 0)[0]),\n    DnsDomain = tostring(strcat_array(array_slice(split(Computer, '.'), 1, -1), '.'))\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 12096000000000,
      "Days": 14,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 14.0,
      "TotalHours": 336.0,
      "TotalMilliseconds": 1209600000.0,
      "TotalMinutes": 20160.0,
      "TotalSeconds": 1209600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Execution"
    ],
    "TemplateVersion": "1.0.5",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "720d12c6-a08c-44c4-b18f-2236412d59b0",
    "CustomDetail": {},
    "Description": "This detection looks for command line parameters associated with the use of Sysinternals sdelete (https://docs.microsoft.com/sysinternals/downloads/sdelete) to delete multiple files on a host's C drive.\nA threat actor may re-name the tool to avoid detection and then use it for destructive attacks on a host.",
    "DisplayName": "Potential re-named sdelete usage",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2900f736-0000-0100-0000-64cabc220000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/85076493-9278-4c85-843a-58422db4ef0f",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:27:13.8910387Z",
    "Name": "85076493-9278-4c85-843a-58422db4ef0f",
    "Query": "SecurityEvent\n| where EventID == 4688\n| where Process !~ \"sdelete.exe\"\n| where CommandLine has_all (\"accepteula\", \"-r\", \"-s\", \"-q\", \"c:/\")\n| where CommandLine !has (\"sdelete\")\n\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion",
      "Impact"
    ],
    "TemplateVersion": "1.0.2",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "6dd2629c-534b-4275-8201-d7968b4fa77e",
    "CustomDetail": {},
    "Description": "This query detects attempts by malware to hide the scheduled task by deleting the SD (Security Descriptor) value. Removal of SD value results in the scheduled task disappearing from schtasks /query and Task Scheduler.\n The query requires auditing to be turned on for HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree registry hive as well as audit policy for registry auditing to be turned on.\n Reference: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/\n Reference: https://4sysops.com/archives/audit-changes-in-the-windows-registry/",
    "DisplayName": "Scheduled Task Hide",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"29009a37-0000-0100-0000-64cabcbc0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/eaa24692-a3ab-42ef-bf2b-2648f5be9e32",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:29:47.1848552Z",
    "Name": "eaa24692-a3ab-42ef-bf2b-2648f5be9e32",
    "Query": "SecurityEvent\n| where EventID == 4657\n| extend EventData = parse_xml(EventData).EventData.Data\n| mv-expand bagexpansion=array EventData\n| evaluate bag_unpack(EventData)\n| extend\n    Key = tostring(column_ifexists('@Name', \"\")),\n    Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, TargetAccount, Computer, EventSourceName, Channel, Task, Level, EventID, Activity, TargetLogonId, SourceComputerId, EventOriginId, Type, _ResourceId, TenantId, SourceSystem, ManagementGroupName, IpAddress, Account)\n| extend\n    ObjectName = column_ifexists('ObjectName', \"\"),\n    OperationType = column_ifexists('OperationType', \"\"),\n    ObjectValueName = column_ifexists('ObjectValueName', \"\")\n| where ObjectName has 'Schedule\\\\TaskCache\\\\Tree'\n    and ObjectValueName == \"SD\"\n    and OperationType == \"%%1906\"  // %%1906 - Registry value deleted\n| extend\n    timestamp = TimeGenerated,\n    HostCustomEntity = Computer,\n    AccountCustomEntity = Account\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "cf3ede88-a429-493b-9108-3e46d3c741f7",
    "CustomDetail": {},
    "Description": "Identifies accounts who have failed to logon to the domain multiple times in a row, followed by a successful authentication\nwithin a short time frame. Multiple failed attempts followed by a success can be an indication of a brute force attempt or\npossible mis-configuration of a service account within an environment.\nThe lookback is set to 2h and the authentication window and threshold are set to 1h and 5, meaning we need to see a minimum\nof 5 failures followed by a success for an account within 1 hour to surface an alert.",
    "DisplayName": "SecurityEvent - Multiple authentication failures followed by a success",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2900d137-0000-0100-0000-64cabdb40000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/e0c04d76-0b8b-49e0-b2fa-dc1ec4061af0",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:33:55.4796089Z",
    "Name": "e0c04d76-0b8b-49e0-b2fa-dc1ec4061af0",
    "Query": "let timeRange = 2h;\nlet authenticationWindow = 1h;\nlet authenticationThreshold = 5;\nSecurityEvent\n| where TimeGenerated > ago(timeRange)\n| where EventID in (4624, 4625)\n| where IpAddress != \"-\" and isnotempty(Account)\n| extend Outcome = iff(EventID == 4624, \"Success\", \"Failure\")\n// bin outcomes into 10 minute windows to reduce the volume of data\n| summarize OutcomeCount=count() by bin(TimeGenerated, 10m), Account, IpAddress, Computer, Outcome\n| project TimeGenerated, Account, IpAddress, Computer, Outcome, OutcomeCount\n// sort ready for sessionizing - by account and time of the authentication outcome\n| sort by Account asc, TimeGenerated asc\n| serialize\n// sessionize into failure groupings until either the account changes or there is a success\n| extend SessionStartedUtc = row_window_session(TimeGenerated, timeRange, authenticationWindow, Account != prev(Account) or prev(Outcome) == \"Success\")\n// count the failures in each session\n| summarize\n    FailureCountBeforeSuccess=sumif(OutcomeCount, Outcome == \"Failure\"),\n    StartTime=min(TimeGenerated),\n    EndTime=max(TimeGenerated),\n    make_list(Outcome, 128),\n    make_set(Computer, 128),\n    make_set(IpAddress, 128)\n    by SessionStartedUtc, Account\n// the session must not start with a success, and must end with one\n| where array_index_of(list_Outcome, \"Success\") != 0\n| where array_index_of(list_Outcome, \"Success\") == array_length(list_Outcome) - 1\n| project-away SessionStartedUtc, list_Outcome\n// where the number of failures before the success is above the threshold\n| where FailureCountBeforeSuccess >= authenticationThreshold\n// expand out ip and computer for customer entity assignment\n| mv-expand set_IpAddress, set_Computer\n| extend IpAddress = tostring(set_IpAddress), Computer = tostring(set_Computer)\n| extend\n    timestamp=StartTime,\n    NTDomain = split(Account, '\\\\', 0)[0],\n    Name = split(Account, '\\\\', 1)[0],\n    HostName = tostring(split(Computer, '.', 0)[0]),\n    DnsDomain = tostring(strcat_array(array_slice(split(Computer, '.'), 1, -1), '.'))\n\n",
    "QueryFrequency": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "QueryPeriod": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.4",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "2391ce61-8c8d-41ac-9723-d945b2e90720",
    "CustomDetail": {},
    "Description": "This query identifies user accounts which has over 50 Windows logon failures today and at least 33% of the count of logon failures over the previous 7 days.",
    "DisplayName": "Excessive Windows Logon Failures",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2900cc38-0000-0100-0000-64cabf100000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/b42c4ce7-a789-42ca-aa67-b6d4778dac8f",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:39:42.8754747Z",
    "Name": "b42c4ce7-a789-42ca-aa67-b6d4778dac8f",
    "Query": "let starttime = 8d;\nlet endtime = 1d;\nlet threshold = 0.333;\nlet countlimit = 50;\nSecurityEvent\n| where TimeGenerated >= ago(endtime)\n| where EventID == 4625 and AccountType =~ \"User\"\n| where IpAddress !in (\"127.0.0.1\", \"::1\")\n| summarize\n    StartTime = min(TimeGenerated),\n    EndTime = max(TimeGenerated),\n    CountToday = count()\n    by\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress,\n    Process\n| join kind=leftouter (\n    SecurityEvent\n    | where TimeGenerated between (ago(starttime) .. ago(endtime))\n    | where EventID == 4625 and AccountType =~ \"User\"\n    | where IpAddress !in (\"127.0.0.1\", \"::1\")\n    | summarize CountPrev7day = count()\n        by\n        EventID,\n        Account,\n        LogonTypeName,\n        SubStatus,\n        AccountType,\n        Computer,\n        WorkstationName,\n        IpAddress\n    )\n    on\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress\n| where CountToday >= coalesce(CountPrev7day, 0) * threshold and CountToday >= countlimit\n//SubStatus Codes are detailed here - https://docs.microsoft.com/windows/security/threat-protection/auditing/event-4625\n| extend Reason = case(\n                      SubStatus =~ '0xC000005E',\n                      'There are currently no logon servers available to service the logon request.',\n                      SubStatus =~ '0xC0000064',\n                      'User logon with misspelled or bad user account',\n                      SubStatus =~ '0xC000006A',\n                      'User logon with misspelled or bad password',\n                      SubStatus =~ '0xC000006D',\n                      'Bad user name or password',\n                      SubStatus =~ '0xC000006E',\n                      'Unknown user name or bad password',\n                      SubStatus =~ '0xC000006F',\n                      'User logon outside authorized hours',\n                      SubStatus =~ '0xC0000070',\n                      'User logon from unauthorized workstation',\n                      SubStatus =~ '0xC0000071',\n                      'User logon with expired password',\n                      SubStatus =~ '0xC0000072',\n                      'User logon to account disabled by administrator',\n                      SubStatus =~ '0xC00000DC',\n                      'Indicates the Sam Server was in the wrong state to perform the desired operation',\n                      SubStatus =~ '0xC0000133',\n                      'Clocks between DC and other computer too far out of sync',\n                      SubStatus =~ '0xC000015B',\n                      'The user has not been granted the requested logon type (aka logon right) at this machine',\n                      SubStatus =~ '0xC000018C',\n                      'The logon request failed because the trust relationship between the primary domain and the trusted domain failed',\n                      SubStatus =~ '0xC0000192',\n                      'An attempt was made to logon, but the Netlogon service was not started',\n                      SubStatus =~ '0xC0000193',\n                      'User logon with expired account',\n                      SubStatus =~ '0xC0000224',\n                      'User is required to change password at next logon',\n                      SubStatus =~ '0xC0000225',\n                      'Evidently a bug in Windows and not a risk',\n                      SubStatus =~ '0xC0000234',\n                      'User logon with account locked',\n                      SubStatus =~ '0xC00002EE',\n                      'Failure Reason: An Error occurred during Logon',\n                      SubStatus =~ '0xC0000413',\n                      'Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine',\n                      strcat('Unknown reason substatus: ', SubStatus)\n                  )\n| extend WorkstationName = iff(WorkstationName == \"-\" or isempty(WorkstationName), Computer, WorkstationName)\n| project\n    StartTime,\n    EndTime,\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    Reason,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress,\n    CountToday,\n    CountPrev7day,\n    Avg7Day = round(CountPrev7day * 1.00 / 7, 2),\n    Process\n| summarize\n    StartTime = min(StartTime),\n    EndTime = max(EndTime),\n    Computer = make_set(Computer, 128),\n    IpAddressList = make_set(IpAddress, 128),\n    sum(CountToday),\n    sum(CountPrev7day),\n    avg(Avg7Day)\n    by\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    Reason,\n    AccountType,\n    WorkstationName,\n    Process\n| order by sum_CountToday desc nulls last\n| extend\n    timestamp = StartTime,\n    NTDomain = tostring(split(Account, '\\\\', 0)[0]),\n    Name = tostring(split(Account, '\\\\', 1)[0]),\n    HostName = tostring(split(WorkstationName, '.', 0)[0]),\n    DnsDomain = tostring(strcat_array(array_slice(split(WorkstationName, '.'), 1, -1), '.'))\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 6912000000000,
      "Days": 8,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 8.0,
      "TotalHours": 192.0,
      "TotalMilliseconds": 691200000.0,
      "TotalMinutes": 11520.0,
      "TotalSeconds": 691200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "2.0.2",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "d57c33a9-76b9-40e0-9dfa-ff0404546410",
    "CustomDetail": {},
    "Description": "This detection uses Sysmon events (NetworkConnect events) to detect incoming network traffic on port 80 on AD FS servers. This could be a sign of a threat actor\ntrying to use replication services on the AD FS server to get its configuration settings and extract sensitive information such as AD FS certificates.\nIn order to use this query you need to enable Sysmon telemetry on the AD FS Server.\nReference: https://twitter.com/OTR_Community/status/1387038995016732672",
    "DisplayName": "AD FS Remote HTTP Network Connection",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2900583a-0000-0100-0000-64cac0da0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/9df83069-bbe2-4f2e-b620-709b449b1f0a",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:47:21.5664088Z",
    "Name": "9df83069-bbe2-4f2e-b620-709b449b1f0a",
    "Query": "// Adjust this to use a longer timeframe to identify ADFS servers\n//let lookback = 0d;\n// Adjust this to adjust detection timeframe\n//let timeframe = 1d;\n// Filter out other servers in the AD FS farm\nlet ADFSServersList = dynamic([\"ADFS02.domain.com\",\"ADFS03.domain.com\"]);\n// Start by identifying ADFS servers to reduce FP chance\nlet ADFS_Servers = (\nEvent\n//| where TimeGenerated > ago(timeframe+lookback)\n| where Source == \"Microsoft-Windows-Sysmon\"\n| where EventID == 18\n| where Computer !in (ADFSServersList)\n| extend EventData = parse_xml(EventData).DataItem.EventData.Data\n| mv-expand bagexpansion=array EventData\n| evaluate bag_unpack(EventData)\n| extend Key = tostring(column_ifexists('@Name', \"\")), Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, Source, EventLog, Computer, EventLevel, EventLevelName, EventID, UserName, MG, ManagementGroupName, _ResourceId)\n| extend Image = column_ifexists(\"Image\", \"\")\n| extend process = split(Image, '\\\\', -1)[-1]\n| where process =~ \"Microsoft.IdentityServer.ServiceHost.exe\"\n| summarize by Computer\n);\n// Look for ADFS servers receiving connections over port 80\nEvent\n//| where TimeGenerated > ago(timeframe)\n| where Source == \"Microsoft-Windows-Sysmon\"\n| where Computer in~ (ADFS_Servers)\n| extend RenderedDescription = tostring(split(RenderedDescription, \":\")[0])\n| extend EventData = parse_xml(EventData).DataItem.EventData.Data\n| mv-expand bagexpansion=array EventData\n| evaluate bag_unpack(EventData)\n| extend Key = tostring(column_ifexists('@Name', \"\")), Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, Source, EventLog, Computer, EventLevel, EventLevelName, EventID, UserName, RenderedDescription, MG, ManagementGroupName, _ResourceId)\n| extend RuleName = column_ifexists(\"RuleName\", \"\"), TechniqueId = column_ifexists(\"TechniqueId\", \"\"),  TechniqueName = column_ifexists(\"TechniqueName\", \"\")\n| parse RuleName with * 'technique_id=' TechniqueId ',' * 'technique_name=' TechniqueName\n| where EventID == 3\n// Look for endpoints connecting to the AD FS server over port 80\n| extend DestinationPort = column_ifexists(\"DestinationPort\", \"\"), Image = column_ifexists(\"Image\", \"\"), Initiated = column_ifexists(\"Initiated\", \"\"), SourceIp = column_ifexists(\"DestinationIp\", \"\"), DestinationIp = column_ifexists(\"DestinationIp\", \"\")\n| where DestinationPort == 80\n| extend process = split(Image, '\\\\', -1)[-1]\n// Look for the System process receiving connections\n| where process == 'System' and Initiated == 'false'\n| where DestinationIp !in ('::1','0:0:0:0:0:0:0:1')\n| extend Operation = RenderedDescription\n| project-reorder TimeGenerated, Operation, Image, Computer, UserName\n| extend HostCustomEntity = Computer, AccountCustomEntity = UserName, IPCustomEntity = SourceIp\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Collection"
    ],
    "TemplateVersion": "1.0.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "faf1a6ff-53b5-4f92-8c55-4b20e9957594",
    "CustomDetail": {},
    "Description": "This query uses Windows Event ID 5136 in order to detect potential webshell deployment by exploitation of CVE-2021-27065.\nThis query looks for changes to the InternalHostName or ExternalHostName properties of Exchange OAB Virtual Directory objects in AD Directory Services\nwhere the new objects contain potential webshell objects. Ref: https://aka.ms/ExchangeVulns",
    "DisplayName": "Exchange OAB Virtual Directory Attribute Containing Potential Webshell",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"2900793a-0000-0100-0000-64cac1780000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/4cba9326-d25e-4a76-95bf-321a7add4fc7",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-02T20:49:59.4785067Z",
    "Name": "4cba9326-d25e-4a76-95bf-321a7add4fc7",
    "Query": "SecurityEvent\n// Look for specific Directory Service Changes and parse data\n| where EventID == 5136\n| extend EventData = parse_xml(EventData).EventData.Data\n| mv-expand bagexpansion = array EventData\n| evaluate bag_unpack(EventData)\n| extend\n    Key = tostring(column_ifexists('@Name', \"\")),\n    Value = column_ifexists('#text', \"\")\n| evaluate pivot(Key, any(Value), TimeGenerated, EventID, Computer, Account, AccountType, EventSourceName, Activity, SubjectAccount)\n// Where changes relate to Exchange OAB\n| extend ObjectClass = column_ifexists(\"ObjectClass\", \"\")\n| where ObjectClass =~ \"msExchOABVirtualDirectory\"\n// Look for InternalHostName or ExternalHostName properties being changed\n| extend AttributeLDAPDisplayName = column_ifexists(\"AttributeLDAPDisplayName\", \"\")\n| where AttributeLDAPDisplayName in~ (\"msExchExternalHostName\", \"msExchInternalHostName\")\n// Look for suspected webshell activity\n| extend AttributeValue = column_ifexists(\"AttributeValue\", \"\")\n| where AttributeValue has \"script\"\n| project-rename LastSeen = TimeGenerated\n| extend ObjectDN = column_ifexists(\"ObjectDN\", \"\")\n| project-reorder LastSeen, Computer, Account, ObjectDN, AttributeLDAPDisplayName, AttributeValue\n| extend timestamp = LastSeen, AccountCustomEntity = Account, HostCustomEntity = Computer\n\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "7ad4c32b-d0d2-411c-a0e8-b557afa12fce",
    "CustomDetail": {},
    "Description": "Encoding malicious software is a technique used to obfuscate files from detection.\nThe first CommandLine component is looking for Python decoding base64.\nThe second CommandLine component is looking for Bash/sh command line base64 decoding.\nThe third one is looking for Ruby decoding base64.",
    "DisplayName": "NRT Process executed from binary hidden in Base64 encoded file",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1b005a0b-0000-0100-0000-64cc0d9b0000\"",
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/32fa928f-d2de-4d62-8386-bb301aeb72a2",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-03T20:27:06.3436743Z",
    "Name": "32fa928f-d2de-4d62-8386-bb301aeb72a2",
    "Query": "SecurityEvent\n| where EventID == 4688\n| where isnotempty(CommandLine)\n| project\n    TimeGenerated,\n    Computer,\n    Account = SubjectUserName,\n    AccountDomain = SubjectDomainName,\n    FileName = Process,\n    CommandLine,\n    ParentProcessName\n| where CommandLine contains \".decode('base64')\"\n    or CommandLine contains \"base64 --decode\"\n    or CommandLine contains \".decode64(\"\n\n",
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Execution",
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.0",
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "d9f28fdf-abc8-4f1a-a7e7-1aaec87a2fc5",
    "CustomDetail": {},
    "Description": "This query looks for the Sdelete process being run recursively after being deployed to a host via GPO. Attackers could use this technique to deploy Sdelete to multiple host and delete data on them.",
    "DisplayName": "Sdelete deployed via GPO and run recursively",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1b00e913-0000-0100-0000-64cc0e510000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/e2b67871-ebb0-4196-87ed-900da8702a58",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-03T20:30:08.9376834Z",
    "Name": "e2b67871-ebb0-4196-87ed-900da8702a58",
    "Query": "SecurityEvent\n  | where EventID == 4688\n  | where Process =~ \"svchost.exe\"\n  | where CommandLine has \"-k GPSvcGroup\" or CommandLine has \"-s gpsvc\"\n  | extend timekey = bin(TimeGenerated, 1m)\n  | project timekey, NewProcessId, Computer\n  | join kind=inner (SecurityEvent\n  | where EventID == 4688\n  | where Process =~ \"sdelete.exe\" or CommandLine has \"sdelete\"\n  | where ParentProcessName endswith \"svchost.exe\"\n  | where CommandLine has_all (\"-s\", \"-r\")\n  | extend newProcess = Process\n  | extend timekey = bin(TimeGenerated, 1m)\n  ) on $left.NewProcessId == $right.ProcessId, timekey, Computer\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Impact"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "05b4bccd-dd12-423d-8de4-5a6fb526bb4f",
    "CustomDetail": {},
    "Description": "This detection highlights executables deployed to hosts via either the Default Domain or Default Domain Controller Policies. These policies apply to all hosts or Domain Controllers and best practice is that these policies should not be used for deployment of files.\nA threat actor may use these policies to deploy files or scripts to all hosts in a domain.",
    "DisplayName": "New EXE deployed via Default Domain or Default Domain Controller Policies",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1b00118b-0000-0100-0000-64cc0f6d0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/e4e815b8-2fb7-4936-8ee1-a6d17e31dc1b",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-03T20:34:52.5931633Z",
    "Name": "e4e815b8-2fb7-4936-8ee1-a6d17e31dc1b",
    "Query": "let known_processes = (\n  SecurityEvent\n  // If adjusting Query Period or Frequency update these\n  | where TimeGenerated between(ago(14d)..ago(1d))\n  | where EventID == 4688\n  | where NewProcessName has_any (\"Policies\\\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\", \"Policies\\\\{31B2F340-016D-11D2-945F-00C04FB984F9}\")\n  | summarize by Process);\n  SecurityEvent\n  // If adjusting Query Period or Frequency update these\n  | where TimeGenerated > ago(1d)\n  | where EventID == 4688\n  | where NewProcessName has_any (\"Policies\\\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\", \"Policies\\\\{31B2F340-016D-11D2-945F-00C04FB984F9}\")\n  | where Process !in (known_processes)\n  // This will likely apply to multiple hosts so summarize these data\n  | summarize FirstSeen=min(TimeGenerated), LastSeen=max(TimeGenerated) by Process, NewProcessName, CommandLine, Computer\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 12096000000000,
      "Days": 14,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 14.0,
      "TotalHours": 336.0,
      "TotalMilliseconds": 1209600000.0,
      "TotalMinutes": 20160.0,
      "TotalSeconds": 1209600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Execution",
      "LateralMovement"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "508cef41-2cd8-4d40-a519-b04826a9085f",
    "CustomDetail": {},
    "Description": "Checks for event id 1102 which indicates the security event log was cleared.\nIt uses Event Source Name \"Microsoft-Windows-Eventlog\" to avoid generating false positives from other sources, like AD FS servers for instance.",
    "DisplayName": "NRT Security Event log cleared",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1b0091b4-0000-0100-0000-64cc0fcf0000\"",
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/f88222fb-96a7-4bd9-9b08-bea430707bb7",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-03T20:36:30.8975404Z",
    "Name": "f88222fb-96a7-4bd9-9b08-bea430707bb7",
    "Query": "SecurityEvent\n| where EventID == 1102 and EventSourceName == \"Microsoft-Windows-Eventlog\"\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), EventCount = count() by Computer, Account, EventID, Activity\n",
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.0",
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "c3e5dbaa-a540-408c-8b36-68bdfb3df088",
    "CustomDetail": {},
    "Description": "This detection identifies instances of a base64 encoded PE file header seen in the process command line parameter.",
    "DisplayName": "NRT Base64 Encoded Windows Process Command-lines",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"1b00abcc-0000-0100-0000-64cc103c0000\"",
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/ae1b17a3-bcfe-40ad-a7c5-d76b7dcd6710",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-03T20:38:19.2830169Z",
    "Name": "ae1b17a3-bcfe-40ad-a7c5-d76b7dcd6710",
    "Query": "SecurityEvent\n | where EventID == 4688\n | where isnotempty(CommandLine)\n | where CommandLine contains \"TVqQAAMAAAAEAAA\"\n | extend HostName = tostring(split(Computer, '.', 0)[0]), DnsDomain = tostring(strcat_array(array_slice(split(Computer, '.'), 1, -1), '.'))\n",
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Execution",
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.1",
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "Heartbeat silent health alert",
    "DisplayName": "TS-Agent heartbeat silent more than 30 min during last 24 hours",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9000f8a0-0000-0100-0000-656a273a0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": true,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [
      "Host",
      "IP"
    ],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/8a403a33-a9af-4957-991b-a5a89f3d5138",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-12-01T18:34:34.465713Z",
    "Name": "8a403a33-a9af-4957-991b-a5a89f3d5138",
    "Query": "Heartbeat\n//| where TimeGenerated >= ago(24h) //Set lookback period\n| summarize LastHeartbeat=arg_max(TimeGenerated, *) by Computer\n//Set offline criteria\n| extend Alive = case (LastHeartbeat >= now(-30m), 'Yes', 'No')\n//Calculate minutes since last heartbeat \n| extend MinutesSilent = datetime_diff('minute', now(), LastHeartbeat)\n| where Alive == 'No'\n| project Computer, ComputerIP, OSType, Alive, LastHeartbeat, MinutesSilent, ComputerEnvironment \n\n",
    "QueryFrequency": {
      "Ticks": 3000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 5,
      "Seconds": 0,
      "TotalDays": 0.003472222222222222,
      "TotalHours": 0.08333333333333333,
      "TotalMilliseconds": 300000.0,
      "TotalMinutes": 5.0,
      "TotalSeconds": 300.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "e7ec9fa6-e7f7-41ed-a34b-b956837a3ee6",
    "CustomDetail": {},
    "Description": "Identifies failed logon attempts from unknown users in Syslog authpriv logs. The unknown user means the account that tried to log in \nisn't provisioned on the machine. A few hits could indicate someone attempting to access a machine they aren't authorized to access. \nIf there are many of hits, especially from outside your network, it could indicate a brute force attack. \nDefault threshold for logon attempts is 15.",
    "DisplayName": "Failed logon attempts in authpriv",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0d004feb-0000-0100-0000-64cd53350000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/bb0a6b94-9354-4cf4-98c8-a23c0aea7bad",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-04T19:36:18.5344542Z",
    "Name": "bb0a6b94-9354-4cf4-98c8-a23c0aea7bad",
    "Query": "let threshold = 15;\n// Below pulls messages from syslog-authpriv logs where there was an authentication failure with an unknown user.\n// IP address of system attempting logon is also extracted from the SyslogMessage field. Some of these messages\n// are aggregated.\nSyslog\n| where Facility =~ \"authpriv\"\n| where SyslogMessage has \"authentication failure\" and SyslogMessage has \" uid=0\"\n| parse SyslogMessage with * \"rhost=\" RemoteIP\n| project TimeGenerated, Computer, ProcessName, HostIP, RemoteIP, ProcessID\n| join kind=innerunique (\n    // Below pulls messages from syslog-authpriv logs that show each instance an unknown user tried to logon. \n    Syslog \n    | where Facility =~ \"authpriv\"\n    | where SyslogMessage has \"user unknown\"\n    | project Computer, HostIP, ProcessID\n    )\n    on Computer, HostIP, ProcessID\n// Count the number of failed logon attempts by External IP and internal machine\n| summarize\n    FirstLogonAttempt = min(TimeGenerated),\n    LatestLogonAttempt = max(TimeGenerated),\n    TotalLogonAttempts = count()\n    by Computer, HostIP, RemoteIP\n// Calculate the time between first and last logon attempt (AttemptPeriodLength)\n| extend TimeBetweenLogonAttempts = LatestLogonAttempt - FirstLogonAttempt\n| where TotalLogonAttempts >= threshold\n| project\n    FirstLogonAttempt,\n    LatestLogonAttempt,\n    TimeBetweenLogonAttempts,\n    TotalLogonAttempts,\n    SourceAddress = RemoteIP,\n    DestinationHost = Computer,\n    DestinationAddress = HostIP\n| sort by DestinationHost asc nulls last\n| extend\n    timestamp = FirstLogonAttempt,\n    HostCustomEntity = DestinationHost,\n    IPCustomEntity = DestinationAddress\n\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "e1ce0eab-10d1-4aae-863f-9a383345ba88",
    "CustomDetail": {},
    "Description": "Identifies an IP address that had 15 failed attempts to sign in via SSH in a 4 hour block during a 24 hour time period.\n Please note that entity mapping for arrays is not supported, so when there is a single value in an array, we will pull that\n value from the array as a single string to populate the entity to support entity mapping features within Sentinel. Additionally,\n if the array is multivalued, we will input a string to indicate this with a unique hash so that matching will not occur.\n As an example - ComputerList is an array that we check for a single value and write that into the HostName field for use in \n the entity mapping within Sentinel.",
    "DisplayName": "SSH - Potential Brute Force",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0e00e805-0000-0100-0000-64cd545f0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/9d90dd83-7441-4e70-9430-f6eb4a736442",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-04T19:41:17.7099879Z",
    "Name": "9d90dd83-7441-4e70-9430-f6eb4a736442",
    "Query": "\nlet threshold = 15;\nSyslog\n| where ProcessName =~ \"sshd\" \n| where SyslogMessage contains \"Failed password for invalid user\"\n| parse kind=relaxed SyslogMessage with * \"invalid user \" user \" from \" ip \" port\" port \" ssh2\" *\n// using distinct below as it has been seen that Syslog can duplicate entries depending on implementation\n| distinct TimeGenerated, Computer, user, ip, port, SyslogMessage, _ResourceId\n| summarize EventTimes = make_list(TimeGenerated), PerHourCount = count() by bin(TimeGenerated,4h), ip, Computer, user, _ResourceId\n| where PerHourCount > threshold\n| mvexpand EventTimes\n| extend EventTimes = tostring(EventTimes) \n| summarize StartTime = min(EventTimes), EndTime = max(EventTimes), UserList = make_set(user), ComputerList = make_set(Computer), ResourceIdList = make_set(_ResourceId), sum(PerHourCount) by IPAddress = ip\n// bringing through single computer and user if array only has 1, otherwise, referencing the column and hashing the ComputerList or UserList so we don't get accidental entity matches when reviewing alerts\n| extend HostName = iff(array_length(ComputerList) == 1, tostring(ComputerList[0]), strcat(\"SeeComputerListField\",\"_\", tostring(hash(tostring(ComputerList)))))\n| extend Account = iff(array_length(ComputerList) == 1, tostring(UserList[0]), strcat(\"SeeUserListField\",\"_\", tostring(hash(tostring(UserList)))))\n| extend ResourceId = iff(array_length(ResourceIdList) == 1, tostring(ResourceIdList[0]), strcat(\"SeeResourceIdListField\",\"_\", tostring(hash(tostring(ResourceIdList)))))\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.1.2",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "737a2ce1-70a3-4968-9e90-3e6aca836abf",
    "Description": "This detection uses machine learning (ML) to identify anomalous Remote Desktop Protocol (RDP) login activity, based on Windows Security Event data. Scenarios include:\n\n*\tUnusual IP - This IP address has not or has rarely been seen in last 30 days.\n*\tUnusual Geo - The IP address, city, country and ASN have not (or rarely) been seen in last 30 days.\n*\tNew user - A new user logs in from an IP address and geo location, both or either of which are not expected to be seen in the last 30 days.\n\nAllow 7 days after this alert is enabled for Microsoft Sentinel to build a profile of normal activity for your environment.\t\n\nThis detection requires a specific configuration of the data source. [Learn more](https://docs.microsoft.com/en-us/azure/sentinel/connect-windows-security-events)\n\nBy enabling this rule, you give Microsoft permission to copy ingested data outside of your Microsoft Sentinel workspace's geography as necessary for processing by the machine learning engine.",
    "DisplayName": "(Preview) Anomalous RDP Login Detections",
    "Enabled": true,
    "Etag": "\"06006ce7-0000-0100-0000-64d270b50000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/41f13c41-ab2c-4484-a296-366598e21918",
    "Kind": {},
    "LastModifiedUtc": "2023-08-08T16:43:33.4406195Z",
    "Name": "41f13c41-ab2c-4484-a296-366598e21918",
    "Severity": {},
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "86e9409f-b9ea-4e9a-8b72-5132ba43bcae",
    "CustomDetail": {},
    "Description": "Detects WAF \"Allowed\" action on threat events.",
    "DisplayName": "Fortiweb - WAF Allowed threat",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0800b734-0000-0100-0000-64d2d97c0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/78c15c25-a84f-435c-9f2d-467c54784663",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-09T00:10:33.9487591Z",
    "Name": "78c15c25-a84f-435c-9f2d-467c54784663",
    "Query": "Fortiweb\n| where EventType =~ 'Attack'\n| where DvcAction =~ 'Allow'\n| summarize count() by SrcIpAddr\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "TemplateVersion": "1.0.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "795edf2d-cf3e-45b5-8452-fe6c9e6a582e",
    "CustomDetail": {},
    "Description": "Identifies when the Cisco ASA Threat Detection engine fired an alert based on malicious activity occurring on the network inicated by DeviceEventClassID 733101-733105\nResources: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html\nDetails on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",
    "DisplayName": "Cisco ASA - threat detection message fired",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0b005965-0000-0100-0000-64d400eb0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/99f36d0e-4810-47db-acbe-1ced4a00e0e2",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-09T21:11:05.9838263Z",
    "Name": "99f36d0e-4810-47db-acbe-1ced4a00e0e2",
    "Query": "CommonSecurityLog\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID in (\"733101\",\"733102\",\"733103\",\"733104\",\"733105\")\n| extend timestamp = TimeGenerated, IPCustomEntity = SourceIP, HostCustomEntity = DeviceName\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Discovery",
      "Impact"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "79f29feb-6a9d-4cdf-baaa-2daf480a5da1",
    "CustomDetail": {},
    "Description": "This will help you determine if Cisco ASA devices are under heavier attack than normal over the last hour versus the previous 6 hours based on DeviceEventClassID 733100\nReferences: https://www.cisco.com/c/en/us/td/docs/security/asa/syslog/b_syslog/syslogs9.html\nDetails on how to further troubleshoot/investigate: https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/113685-asa-threat-detection.html",
    "DisplayName": "Cisco ASA - average attack detection rate increase",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0b009067-0000-0100-0000-64d401fc0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/c81f3653-fcc4-4a95-887d-af4626aed5d0",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-09T21:15:39.9819422Z",
    "Name": "c81f3653-fcc4-4a95-887d-af4626aed5d0",
    "Query": "let timeframe = 1h;\nlet last1h = CommonSecurityLog\n| where TimeGenerated >= ago(timeframe)\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID == \"733100\"\n| extend SourceOfDropRateCount = tostring(split(tostring(split(Message, \"]\")[0]),\"[ \")[1])\n| extend splitMessage = split(Message, \".\")\n| extend DropRate = tostring(split(tostring(splitMessage[0]),\"] \")[1])\n| extend CurrentBurstRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[0]),\"is \")\n| extend CurrentBurstRatePerSec = toint(split(tostring(CurrentBurstRate[1]),\" \")[0])\n| extend MaxConfiguredBurstRate = toint(CurrentBurstRate[2])\n| extend CurrentAvgRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[1]),\"is \")\n| extend CurrentAvgRatePerSec = toint(split(tostring(CurrentAvgRate[1]),\" \")[0])\n| extend MaxConfiguredAvgRate = toint(CurrentAvgRate[2])\n| extend CumulativeTotal = toint(split(tostring(split(tostring(splitMessage[1]),\"  \")[2]),\"is \")[1])\n| summarize last1hCumTotal = sum(CumulativeTotal), last1hAvgRatePerSec = avg(CurrentAvgRatePerSec), last1hAvgBurstRatePerSec = avg(CurrentBurstRatePerSec) by DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate;\nlet prev6h = CommonSecurityLog\n| where TimeGenerated between (ago(6h) .. ago(1h))\n| where isempty(CommunicationDirection)\n| where DeviceEventClassID == \"733100\"\n| extend SourceOfDropRateCount = tostring(split(tostring(split(Message, \"]\")[0]),\"[ \")[1])\n| extend splitMessage = split(Message, \".\")\n| extend DropRate = tostring(split(tostring(splitMessage[0]),\"] \")[1])\n| extend CurrentBurstRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[0]),\"is \")\n| extend prevCurrentBurstRatePerSec = toint(split(tostring(CurrentBurstRate[1]),\" \")[0])\n| extend prevMaxConfiguredBurstRate = toint(CurrentBurstRate[2])\n| extend CurrentAvgRate = split(tostring(split(tostring(splitMessage[1]),\"  \")[1]),\"is \")\n| extend prevCurrentAvgRatePerSec = toint(split(tostring(CurrentAvgRate[1]),\" \")[0])\n| extend prevMaxConfiguredAvgRate = toint(CurrentAvgRate[2])\n| extend prevCumulativeTotal = toint(split(tostring(split(tostring(splitMessage[1]),\"  \")[2]),\"is \")[1])\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), prev6hCumTotal = sum(prevCumulativeTotal), prev6hAvgRatePerSec = avg(prevCurrentAvgRatePerSec), prev6hAvgBurstRatePerSec = avg(prevCurrentBurstRatePerSec)\nby DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate;\nlast1h | join (\n  prev6h\n) on DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate\n| project StartTimeUtc, EndTimeUtc, DeviceName, DeviceEventClassID, SourceIP, SourceOfDropRateCount, DropRate, last1hCumTotal, prev6hCumTotal, prev6hAvgCumTotal = prev6hCumTotal/6, last1hAvgRatePerSec, prev6hAvgRatePerSec, last1hAvgBurstRatePerSec, prev6hAvgBurstRatePerSec\n// Select only events that indicate a doubling of the expected rate in the last hour over the previous 6 hours\n| where last1hCumTotal > 2*prev6hAvgCumTotal or last1hAvgRatePerSec > 2*prev6hAvgRatePerSec or last1hAvgBurstRatePerSec > 2*prev6hAvgBurstRatePerSec\n| extend timestamp = StartTimeUtc, IPCustomEntity = SourceIP, HostCustomEntity = DeviceName\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 216000000000,
      "Days": 0,
      "Hours": 6,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.25,
      "TotalHours": 6.0,
      "TotalMilliseconds": 21600000.0,
      "TotalMinutes": 360.0,
      "TotalSeconds": 21600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Discovery",
      "Impact"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "Delete operations performed in your Microsoft Sentinel workspace",
    "DisplayName": "c_deleteOpsPerformed",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9900d150-0000-0100-0000-64e771440000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/fed169de-1800-4a64-a6ce-9e0e526f6938",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T15:03:30.1041752Z",
    "Name": "fed169de-1800-4a64-a6ce-9e0e526f6938",
    "Query": "AuditLogs\r\n| where AADOperationType == \"Delete\"\r\n| where Result == \"success\"\r\n| project TimeGenerated, OperationName\r\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "194dd92e-d6e7-4249-85a5-273350a7f5ce",
    "CustomDetail": {},
    "Description": "Identifies when the exchange audit logging has been disabled which may be an adversary attempt\nto evade detection or avoid other defenses.",
    "DisplayName": "c_Exchange AuditLog disabled",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9900bc54-0000-0100-0000-64e771510000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/ec9db1e7-c5c7-4b75-a6f3-3fccf3b46d8a",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T15:03:45.037944Z",
    "Name": "ec9db1e7-c5c7-4b75-a6f3-3fccf3b46d8a",
    "Query": "OfficeActivity\n| where UserType in~ (\"Admin\", \"DcAdmin\") \n| where Operation =~ \"Set-AdminAuditLogConfig\"\n| mv-expand param=parse_json(Parameters)\n| where param[\"Name\"] =~  \"UnifiedAuditLogIngestionEnabled\" and param[\"Value\"] =~ \"False\" // added unified audit log instead of Adminaudit log\n| summarize\n    StartTimeUtc = min(TimeGenerated),\n    EndTimeUtc = max(TimeGenerated),\n    OperationCount = count()\n    by\n    Operation,\n    UserType,\n    UserId,\n    ClientIP,\n    ResultStatus,\n    Parameters // tookout the admin audit parameter\n| extend\n    timestamp = StartTimeUtc,\n    AccountCustomEntity = UserId,\n    IPCustomEntity = ClientIP\n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 8640000000000,
      "Days": 10,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 10.0,
      "TotalHours": 240.0,
      "TotalMilliseconds": 864000000.0,
      "TotalMinutes": 14400.0,
      "TotalSeconds": 864000.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "DefenseEvasion"
    ],
    "TemplateVersion": "1.0.0",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "Sensitve Table Queried",
    "DisplayName": "c_HighRiskQueryRun",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9900f559-0000-0100-0000-64e771610000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": true,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/8e16a2c1-94a0-419e-b25f-7645605945f6",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T15:04:01.1082463Z",
    "Name": "8e16a2c1-94a0-419e-b25f-7645605945f6",
    "Query": "let keywords = dynamic([\"AADUserRiskEvents\", \"IdentityInfo\"]);//specify list of items\nLAQueryLogs\n| extend keyword_lower = tolower(keywords) //convert all items in specified keywords list to lowercase\n| extend querytext_lower = tolower(QueryText) //convert kql queries executed to lowercase\n| where querytext_lower has_any(keywords) //compare values with list mentioned\n| extend searchuser = AADEmail\n| project TimeGenerated, searchuser, QueryText, RequestClientApp, RequestTarget, ResponseCode, ResponseRowCount, ResponseDurationMs, CorrelationId\n\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "532c1811-79ee-4d9f-8d4d-6304c840daa1",
    "Description": "Create incidents based on all alerts generated in Azure Active Directory Identity Protection",
    "DisplayName": "Create incidents based on Azure Active Directory Identity Protection alerts",
    "DisplayNamesExcludeFilter": null,
    "DisplayNamesFilter": null,
    "Enabled": false,
    "Etag": "\"5c009c07-0000-0100-0000-6543ff310000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/4abc3297-5816-4b41-931e-343616c62c29",
    "Kind": {},
    "LastModifiedUtc": "2023-11-02T19:57:37.7353994Z",
    "Name": "4abc3297-5816-4b41-931e-343616c62c29",
    "ProductFilter": {},
    "SeveritiesFilter": null,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "327cd4ed-ca42-454b-887c-54e1c91363c6",
    "Description": "Create incidents based on all alerts generated in Microsoft Defender for Endpoint",
    "DisplayName": "Create incidents based on Microsoft Defender for Endpoint alerts",
    "DisplayNamesExcludeFilter": null,
    "DisplayNamesFilter": null,
    "Enabled": false,
    "Etag": "\"5c009f07-0000-0100-0000-6543ff310000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/7feebc57-556f-4aa9-af55-f0c1af553336",
    "Kind": {},
    "LastModifiedUtc": "2023-11-02T19:57:37.7736753Z",
    "Name": "7feebc57-556f-4aa9-af55-f0c1af553336",
    "ProductFilter": {},
    "SeveritiesFilter": null,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertRuleTemplateName": "ee1d718b-9ed9-4a71-90cd-a483a4f008df",
    "Description": "Create incidents based on all alerts generated in Microsoft Defender for Office 365",
    "DisplayName": "Create incidents based on Microsoft Defender for Office 365 alerts",
    "DisplayNamesExcludeFilter": null,
    "DisplayNamesFilter": null,
    "Enabled": false,
    "Etag": "\"5c009b07-0000-0100-0000-6543ff310000\"",
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/79f327b5-4812-4548-85d4-66ec6dd4786c",
    "Kind": {},
    "LastModifiedUtc": "2023-11-02T19:57:37.507155Z",
    "Name": "79f327b5-4812-4548-85d4-66ec6dd4786c",
    "ProductFilter": {},
    "SeveritiesFilter": null,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "050b9b3d-53d0-4364-a3da-1b678b8211ec",
    "CustomDetail": {},
    "Description": "Identifies when a new privileged role is assigned to a user.  Any account eligible for a role is now being given privileged access. If the assignment is unexpected or into a role that isn't the responsibility of the account holder, investigate.\nRef : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-accounts#things-to-monitor-1",
    "DisplayName": "TS-User Assigned Privileged Role",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9000d29e-0000-0100-0000-656a270c0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/353de1d3-a05c-4621-b6b9-cd9758599a25",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-12-01T18:33:47.8501715Z",
    "Name": "353de1d3-a05c-4621-b6b9-cd9758599a25",
    "Query": "AuditLogs\n| where Category =~ \"RoleManagement\"\n| where AADOperationType in (\"Assign\", \"AssignEligibleRole\")\n| where ActivityDisplayName has_any (\"Add eligible member to role\", \"Add member to role\")\n| mv-expand TargetResources\n| mv-expand TargetResources.modifiedProperties\n| extend displayName_ = tostring(TargetResources_modifiedProperties.displayName)\n| where displayName_ =~ \"Role.DisplayName\"\n| extend RoleName = tostring(parse_json(tostring(TargetResources_modifiedProperties.newValue)))\n| where RoleName contains \"Admin\"\n| extend InitiatingApp = tostring(parse_json(tostring(InitiatedBy.app)).displayName)\n| extend Initiator = iif(isnotempty(InitiatingApp), InitiatingApp, tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName))\n| extend Target = tostring(TargetResources.userPrincipalName)\n| summarize by bin(TimeGenerated, 1h), OperationName,  RoleName, Target, Initiator, Result\n| extend AccountCustomEntity = Target",
    "QueryFrequency": {
      "Ticks": 6000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 10,
      "Seconds": 0,
      "TotalDays": 0.006944444444444444,
      "TotalHours": 0.16666666666666666,
      "TotalMilliseconds": 600000.0,
      "TotalMinutes": 10.0,
      "TotalSeconds": 600.0
    },
    "QueryPeriod": {
      "Ticks": 72000000000,
      "Days": 0,
      "Hours": 2,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.08333333333333333,
      "TotalHours": 2.0,
      "TotalMilliseconds": 7200000.0,
      "TotalMinutes": 120.0,
      "TotalSeconds": 7200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "Persistence"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "Delete operations performed in your Microsoft Sentinel workspace",
    "DisplayName": "TS-deleteOpsPerformed_c",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"8b0079dc-0000-0100-0000-64e73f270000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/feb179f0-8534-48e3-a1b7-a3ebabb2b785",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T11:29:42.7155464Z",
    "Name": "feb179f0-8534-48e3-a1b7-a3ebabb2b785",
    "Query": "AuditLogs\n| where AADOperationType =~ \"Delete\"\n| where Result == \"success\"\n| extend type_ = tostring(TargetResources[0].type)\n| extend targetuserPrincipalName_ = tostring(TargetResources[0].userPrincipalName)\n| extend targetdisplayName = tostring(TargetResources[0].displayName)\n| extend InitiatedByActionUserInformation = iff(isnotempty(InitiatedBy.user.userPrincipalName), InitiatedBy.user.userPrincipalName, InitiatedBy.app.displayName)\n| extend targetusrInformation = iff(targetuserPrincipalName_ != \"\", substring(tostring(TargetResources[0].userPrincipalName), toint(strlen(tostring(TargetResources[0].id))) - countof(tostring(TargetResources[0].id), '-')), targetdisplayName)\n| project targetusrInformation, type_, InitiatedByActionUserInformation\n\n",
    "QueryFrequency": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "InitialAccess"
    ],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "b9d2eebc-5dcb-4888-8165-900db44443ab",
    "CustomDetail": {},
    "Description": "This query detects potential attempts by non-computer accounts (non domain controllers) to retrieve/synchronize an active directory object leveraging directory replication services (DRS).\nA Domain Controller (computer account) would usually be performing these actions in a domain environment. Another detection rule can be created to cover domain controllers accounts doing at rare times.\nA domain user with privileged permissions to use directory replication services is rare. Ref: https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html",
    "DisplayName": "Non Domain Controller Active Directory Replication (2)",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9600fb56-0000-0100-0000-64e7661f0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/f1719fbb-943f-4c76-9ee5-de6c62352edc",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T14:15:58.1037861Z",
    "Name": "f1719fbb-943f-4c76-9ee5-de6c62352edc",
    "Query": "// Enter a reference list of hostnames for your DC servers\n//let DCServersList = dynamic ([\"DC01.simulandlabs.com\",\"DC02.simulandlabs.com\"]);\nSecurityEvent\n//| where Computer in (DCServersList)\n| where EventID == 4662 and ObjectServer == 'DS'\n| where AccountType != 'Machine'\n| where Properties has '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes\n    or Properties has '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes-All\n    or Properties has '89e95b76-444d-4c62-991a-0facbeda640c' //DS-Replication-Get-Changes-In-Filtered-Set\n| project TimeGenerated, Account, Activity, Properties, SubjectLogonId, Computer\n| join kind=leftouter\n(\n    SecurityEvent\n    //| where Computer in (DCServersList)\n    | where EventID == 4624 and LogonType == 3\n    | where AccountType != 'Machine'\n    | project TargetLogonId, IpAddress\n)\non $left.SubjectLogonId == $right.TargetLogonId\n| project-reorder TimeGenerated, Computer, Account, IpAddress\n| extend timestamp = TimeGenerated, AccountCustomEntity = Account, HostCustomEntity = Computer, SourceAddress = IpAddress \n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 6048000000000,
      "Days": 7,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 7.0,
      "TotalHours": 168.0,
      "TotalMilliseconds": 604800000.0,
      "TotalMinutes": 10080.0,
      "TotalSeconds": 604800.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": "b9d2eebc-5dcb-4888-8165-900db44443ab",
    "CustomDetail": {},
    "Description": "This query detects potential attempts by non-computer accounts (non domain controllers) to retrieve/synchronize an active directory object leveraging directory replication services (DRS).\nA Domain Controller (computer account) would usually be performing these actions in a domain environment. Another detection rule can be created to cover domain controllers accounts doing at rare times.\nA domain user with privileged permissions to use directory replication services is rare. Ref: https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html",
    "DisplayName": "Non Domain Controller Active Directory Replication (3)",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9600e570-0000-0100-0000-64e7668b0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": false,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/03024033-144c-4d8d-80f7-4acd3e57156a",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-08-24T14:17:45.9426385Z",
    "Name": "03024033-144c-4d8d-80f7-4acd3e57156a",
    "Query": "// Enter a reference list of hostnames for your DC servers\n//let DCServersList = dynamic ([\"DC01.simulandlabs.com\",\"DC02.simulandlabs.com\"]);\nSecurityEvent\n//| where Computer in (DCServersList)\n| where EventID == 4662 and ObjectServer == 'DS'\n| where AccountType != 'Machine'\n| where Properties has '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes\n    or Properties has '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' //DS-Replication-Get-Changes-All\n    or Properties has '89e95b76-444d-4c62-991a-0facbeda640c' //DS-Replication-Get-Changes-In-Filtered-Set\n| project TimeGenerated, Account, Activity, Properties, SubjectLogonId, Computer\n| join kind=leftouter\n(\n    SecurityEvent\n    //| where Computer in (DCServersList)\n    | where EventID == 4624 and LogonType == 3\n    | where AccountType != 'Machine'\n    | project TargetLogonId, IpAddress\n)\non $left.SubjectLogonId == $right.TargetLogonId\n| project-reorder TimeGenerated, Computer, Account, IpAddress\n| extend timestamp = TimeGenerated, AccountCustomEntity = Account, HostCustomEntity = Computer, SourceAddress = IpAddress \n",
    "QueryFrequency": {
      "Ticks": 864000000000,
      "Days": 1,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 1.0,
      "TotalHours": 24.0,
      "TotalMilliseconds": 86400000.0,
      "TotalMinutes": 1440.0,
      "TotalSeconds": 86400.0
    },
    "QueryPeriod": {
      "Ticks": 6048000000000,
      "Days": 7,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 7.0,
      "TotalHours": 168.0,
      "TotalMilliseconds": 604800000.0,
      "TotalMinutes": 10080.0,
      "TotalSeconds": 604800.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [
      "CredentialAccess"
    ],
    "TemplateVersion": "1.0.1",
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": null,
    "AlertDetailOverrideAlertDisplayNameFormat": null,
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "",
    "DisplayName": "test-Aashish-HealthAlertEmail",
    "Enabled": false,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"0900dfbf-0000-0100-0000-653c14ff0000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": true,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [
      "Host"
    ],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/7fb8499a-7792-4cbf-b078-162d746886d2",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-10-27T19:52:31.5997738Z",
    "Name": "7fb8499a-7792-4cbf-b078-162d746886d2",
    "Query": "AzureActivity\n| sort by TimeGenerated\n| summarize by CallerIpAddress\n",
    "QueryFrequency": {
      "Ticks": 432000000000,
      "Days": 0,
      "Hours": 12,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.5,
      "TotalHours": 12.0,
      "TotalMilliseconds": 43200000.0,
      "TotalMinutes": 720.0,
      "TotalSeconds": 43200.0
    },
    "QueryPeriod": {
      "Ticks": 432000000000,
      "Days": 0,
      "Hours": 12,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.5,
      "TotalHours": 12.0,
      "TotalMilliseconds": 43200000.0,
      "TotalMinutes": 720.0,
      "TotalSeconds": 43200.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  },
  {
    "AlertDetailOverrideAlertDescriptionFormat": "Alert at {{Time}} from {{City}}",
    "AlertDetailOverrideAlertDisplayNameFormat": "Alert for {{UserPrincipalName}} from {{ProviderName}|",
    "AlertDetailOverrideAlertSeverityColumnName": null,
    "AlertDetailOverrideAlertTacticsColumnName": null,
    "AlertRuleTemplateName": null,
    "CustomDetail": {},
    "Description": "login from outside of toronto",
    "DisplayName": "TS-Login from outside Toronto",
    "Enabled": true,
    "EntityMapping": [
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping",
      "Microsoft.Azure.PowerShell.Cmdlets.SecurityInsights.Models.Api20210901Preview.EntityMapping"
    ],
    "Etag": "\"9000269c-0000-0100-0000-656a26f20000\"",
    "EventGroupingSettingAggregationKind": {},
    "GroupingConfigurationEnabled": true,
    "GroupingConfigurationGroupByAlertDetail": [],
    "GroupingConfigurationGroupByCustomDetail": [],
    "GroupingConfigurationGroupByEntity": [],
    "GroupingConfigurationLookbackDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "GroupingConfigurationMatchingMethod": {},
    "GroupingConfigurationReopenClosedIncident": false,
    "Id": "/subscriptions/26613501-ed23-4f10-8aed-bd633914579d/resourceGroups/wksp-ws-01/providers/Microsoft.OperationalInsights/workspaces/wksp-la/providers/Microsoft.SecurityInsights/alertRules/303bc74c-83d9-45a2-8a6b-7ec7392e440d",
    "IncidentConfigurationCreateIncident": true,
    "Kind": {},
    "LastModifiedUtc": "2023-12-01T18:33:20.0064977Z",
    "Name": "303bc74c-83d9-45a2-8a6b-7ec7392e440d",
    "Query": "SigninLogs\n| where UserPrincipalName == \"rpol@telussecuritydev.onmicrosoft.com\"\n| project\n    TimeGenerated,\n    UserPrincipalName,\n    Identity,\n    IPAddress,\n    LocationDetails.city,\n    LocationDetails.state,\n    LocationDetails.countryOrRegion\n| project-rename\n    Time=TimeGenerated,\n    City=LocationDetails_city,\n    Province=LocationDetails_state,\n    Country=LocationDetails_countryOrRegion\n| where City <> \"Toronto\"",
    "QueryFrequency": {
      "Ticks": 6000000000,
      "Days": 0,
      "Hours": 0,
      "Milliseconds": 0,
      "Minutes": 10,
      "Seconds": 0,
      "TotalDays": 0.006944444444444444,
      "TotalHours": 0.16666666666666666,
      "TotalMilliseconds": 600000.0,
      "TotalMinutes": 10.0,
      "TotalSeconds": 600.0
    },
    "QueryPeriod": {
      "Ticks": 36000000000,
      "Days": 0,
      "Hours": 1,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.041666666666666664,
      "TotalHours": 1.0,
      "TotalMilliseconds": 3600000.0,
      "TotalMinutes": 60.0,
      "TotalSeconds": 3600.0
    },
    "Severity": {},
    "SuppressionDuration": {
      "Ticks": 180000000000,
      "Days": 0,
      "Hours": 5,
      "Milliseconds": 0,
      "Minutes": 0,
      "Seconds": 0,
      "TotalDays": 0.20833333333333334,
      "TotalHours": 5.0,
      "TotalMilliseconds": 18000000.0,
      "TotalMinutes": 300.0,
      "TotalSeconds": 18000.0
    },
    "SuppressionEnabled": false,
    "SystemData": {
      "CreatedAt": null,
      "CreatedBy": null,
      "CreatedByType": null,
      "LastModifiedAt": null,
      "LastModifiedBy": null,
      "LastModifiedByType": null
    },
    "SystemDataCreatedAt": null,
    "SystemDataCreatedBy": null,
    "SystemDataCreatedByType": null,
    "SystemDataLastModifiedAt": null,
    "SystemDataLastModifiedBy": null,
    "SystemDataLastModifiedByType": null,
    "Tactic": [],
    "TemplateVersion": null,
    "TriggerOperator": {},
    "TriggerThreshold": 0,
    "Type": "Microsoft.SecurityInsights/alertRules"
  }
]
